<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Start Python</title>
    <meta charset="utf-8" />
    <meta name="author" content="김영우" />
    <script src="libs/header-attrs-2.25/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link rel="stylesheet" href="css/custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">






class: title0

쉽게 배우는 Python 데이터 분석

&lt;!-- ----------------MAIN---------------- --&gt;
&lt;!-- ----------------MAIN---------------- --&gt;
&lt;!-- ----------------MAIN---------------- --&gt;

---



.pull-left[

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

&lt;div style="text-align: center;"&gt; &lt;img src="img/cover.png" style="width: 65%;"&gt; &lt;/div&gt;

]

.pull-right[

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

<svg aria-hidden="true" role="img" viewBox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:-0.5em;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> [github.com/youngwoos/Doit_Python](https://github.com/youngwoos/Doit_Python)

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:-0.5em;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"/></svg> [facebook.com/groups/datacommunity](https://facebook.com/groups/datacommunity)

<svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:-0.5em;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg> [youtube.com/dataholic4](https://youtube.com/dataholic4)

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:-0.5em;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M96 0C43 0 0 43 0 96V416c0 53 43 96 96 96H384h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V384c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H384 96zm0 384H352v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg> [네이버책](https://search.shopping.naver.com/book/catalog/32474211621)

&lt;br-back-10&gt;

&amp;nbsp;&amp;nbsp; ▪ [yes24](http://www.yes24.com/Product/Goods/108947478)

&amp;nbsp;&amp;nbsp; ▪ [알라딘](https://www.aladin.co.kr/shop/wproduct.aspx?ISBN=K162837601)

&amp;nbsp;&amp;nbsp; ▪ [교보문고](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&amp;mallGb=KOR&amp;barcode=9791163033493)

]


---

### 목차 - Part 1

#### [1. 안녕 Python? - 친해지기](#start)
- [변수](#variable)
- [함수](#function)
- [패키지](#package)

#### [2. 데이터 프레임의 세계로](#dataframe)
- [데이터 프레임 만들기](#make_dataframe)
- [외부 데이터 가져오기](#read_file)
- [데이터 프레임을 csv 파일로 저장하기](#write_file)

#### [3. 데이터 분석 기초](#basic)
- [데이터 파악하기](#eda)
- [변수명 바꾸기](#rename)
- [파생 변수 만들기](#derived_variable)
- [조건 함수](#np.where)

---

### 목차 - Part 2

#### [4. 자유자재로 데이터 가공하기](#handling)
- [조건에 맞는 데이터만 추출하기](#filter)
- [필요한 변수만 추출하기](#select)
- [순서대로 정렬하기](#arrange)
- [파생변수 추가하기](#assign)
- [집단별로 요약하기](#groupby_summarise)

---

### 목차 - Part 3

#### [5. 그래프 만들기](#graph)
- [산점도](#point)
- [막대 그래프](#bar)
- [선 그래프](#line)
- [상자 그림](#boxplot)

---

### 목차 - Part 4

#### [6. 데이터 합치기](#join)
- [가로로 합치기](#left_join)
- [세로로 합치기](#bind)

#### [7. 데이터 정제하기](#cleansing)
- [빠진 데이터를 찾아라! - 결측치 정제하기](#missing_value)
- [이상한 데이터를 찾아라! - 이상치 정제하기](#outlier)

#### &lt;svg viewBox="0 0 352 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#5286B8;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M176 80c-52.94 0-96 43.06-96 96 0 8.84 7.16 16 16 16s16-7.16 16-16c0-35.3 28.72-64 64-64 8.84 0 16-7.16 16-16s-7.16-16-16-16zM96.06 459.17c0 3.15.93 6.22 2.68 8.84l24.51 36.84c2.97 4.46 7.97 7.14 13.32 7.14h78.85c5.36 0 10.36-2.68 13.32-7.14l24.51-36.84c1.74-2.62 2.67-5.7 2.68-8.84l.05-43.18H96.02l.04 43.18zM176 0C73.72 0 0 82.97 0 176c0 44.37 16.45 84.85 43.56 115.78 16.64 18.99 42.74 58.8 52.42 92.16v.06h48v-.12c-.01-4.77-.72-9.51-2.15-14.07-5.59-17.81-22.82-64.77-62.17-109.67-20.54-23.43-31.52-53.15-31.61-84.14-.2-73.64 59.67-128 127.95-128 70.58 0 128 57.42 128 128 0 30.97-11.24 60.85-31.65 84.14-39.11 44.61-56.42 91.47-62.1 109.46a47.507 47.507 0 0 0-2.22 14.3v.1h48v-.05c9.68-33.37 35.78-73.18 52.42-92.16C335.55 260.85 352 220.37 352 176 352 78.8 273.2 0 176 0z"&gt;&lt;/path&gt;&lt;/svg&gt; [Options](#option)

---

class: title0

쉽게 배우는 Python 데이터 분석 Part 1

---

name: start
class: title0

&lt;1&gt; 안녕 Python? - 친해지기

---


### 무작정 따라 해보기!

#### 패키지 로드



```python
import pandas as pd
import seaborn as sns
```


#### 데이터 불러오기



```python
mpg = pd.read_csv('mpg.csv')
```

---


#### 데이터 검토


```python
mpg.head()
```

```
  manufacturer model  displ  year  cyl       trans drv  cty  hwy fl category
0         audi    a4    1.8  1999    4    auto(l5)   f   18   29  p  compact
1         audi    a4    1.8  1999    4  manual(m5)   f   21   29  p  compact
2         audi    a4    2.0  2008    4  manual(m6)   f   20   31  p  compact
3         audi    a4    2.0  2008    4    auto(av)   f   21   30  p  compact
4         audi    a4    2.8  1999    6    auto(l5)   f   16   26  p  compact
```

---



```python
mpg.shape
```

```
(234, 11)
```

---


```python
mpg.info()
```

```
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 234 entries, 0 to 233
Data columns (total 11 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   manufacturer  234 non-null    object 
 1   model         234 non-null    object 
 2   displ         234 non-null    float64
 3   year          234 non-null    int64  
 4   cyl           234 non-null    int64  
 5   trans         234 non-null    object 
 6   drv           234 non-null    object 
 7   cty           234 non-null    int64  
 8   hwy           234 non-null    int64  
 9   fl            234 non-null    object 
 10  category      234 non-null    object 
dtypes: float64(1), int64(4), object(6)
memory usage: 20.2+ KB
```

---


```python
mpg.describe()
```

```
            displ         year         cyl         cty         hwy
count  234.000000   234.000000  234.000000  234.000000  234.000000
mean     3.471795  2003.500000    5.888889   16.858974   23.440171
std      1.291959     4.509646    1.611534    4.255946    5.954643
min      1.600000  1999.000000    4.000000    9.000000   12.000000
25%      2.400000  1999.000000    4.000000   14.000000   18.000000
50%      3.300000  2003.500000    6.000000   17.000000   24.000000
75%      4.600000  2008.000000    8.000000   19.000000   27.000000
max      7.000000  2008.000000    8.000000   35.000000   44.000000
```


---



#### 데이터 분석

&lt;br-back-10&gt;

##### 1. 회사별 평균 연비 높은순 정렬

```python
mpg.groupby('manufacturer') \
   .agg(mean_hwy = ('hwy', 'mean')) \
   .sort_values('mean_hwy', ascending = False)
```

```
               mean_hwy
manufacturer           
honda         32.555556
volkswagen    29.222222
hyundai       26.857143
audi          26.444444
pontiac       26.400000
subaru        25.571429
toyota        24.911765
nissan        24.615385
chevrolet     21.894737
ford          19.360000
mercury       18.000000
dodge         17.945946
jeep          17.625000
lincoln       17.000000
land rover    16.500000
```


---

#### 그래프 만들기

##### 2. 배기량과 연비의 관계 그래프

```python
sns.scatterplot(data = mpg, x = 'displ', y = 'hwy')
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-18-1.png" width="60%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-18-2.png" width="60%" /&gt;

---

class: title0

데이터 분석을 위한 연장 챙기기

---
name: variable
class: title1

변수

---

#### mpg 데이터의 변수 다뤄보기


```python
import pandas as pd           # 패키지 로드
mpg = pd.read_csv('mpg.csv')  # 데이터 불러오기
mpg                           # 출력
```

```
    manufacturer   model  displ  year  cyl  ... drv cty  hwy  fl category
0           audi      a4    1.8  1999    4  ...   f  18   29   p  compact
1           audi      a4    1.8  1999    4  ...   f  21   29   p  compact
2           audi      a4    2.0  2008    4  ...   f  20   31   p  compact
3           audi      a4    2.0  2008    4  ...   f  21   30   p  compact
4           audi      a4    2.8  1999    6  ...   f  16   26   p  compact
..           ...     ...    ...   ...  ...  ...  ..  ..  ...  ..      ...
229   volkswagen  passat    2.0  2008    4  ...   f  19   28   p  midsize
230   volkswagen  passat    2.0  2008    4  ...   f  21   29   p  midsize
231   volkswagen  passat    2.8  1999    6  ...   f  16   26   p  midsize
232   volkswagen  passat    2.8  1999    6  ...   f  18   26   p  midsize
233   volkswagen  passat    3.6  2008    6  ...   f  17   26   p  midsize

[234 rows x 11 columns]
```

---


```python
mpg['hwy']
```

```
0      29
1      29
2      31
3      30
4      26
       ..
229    28
230    29
231    26
232    26
233    26
Name: hwy, Length: 234, dtype: int64
```

---


```python
mpg['hwy'].mean()
```

```
23.44017094017094
```

--

```python
mpg['hwy'].max()
```

```
44
```
---



```python
import seaborn as sns
sns.histplot(x = mpg['hwy'])
```

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-23-5.png" width="60%" /&gt;


---

#### 변수 만들기


```python
a = 1
a
```

```
1
```

--


```python
b = 2
b
```

```
2
```

```python
c = 3
c
```

```
3
```

```python
ab = 3.5
ab
```

```
3.5
```


---


#### 변수로 연산하기

```python
a + b
```

```
3
```

```python
a + b + c
```

```
6
```

```python
4 / b
```

```
2.0
```

```python
5 * b
```

```
10
```

---

#### 연속값이 들어 있는 변수 만들기 - List

```python
d = [1, 2, 3]
d
```

```
[1, 2, 3]
```

```python
e = [3, 4, 5]
e
```

```
[3, 4, 5]
```

---

#### List 더하기

```python
d + e
```

```
[1, 2, 3, 3, 4, 5]
```


---


#### 문자 변수 만들기

```python
a2 = 'a'
a2
```

```
'a'
```

```python
b2 = 'text'
b2
```

```
'text'
```

```python
c2 = 'Hello world!'
c2
```

```
'Hello world!'
```


---


#### 연속 문자 List 만들기

```python
d2 = ['a', 'b', 'c']
d2
```

```
['a', 'b', 'c']
```

```python
e2 = ['Hello!', 'World', 'is', 'good!']
e2
```

```
['Hello!', 'World', 'is', 'good!']
```


---

#### 문자 변수끼리 더하기

```python
b2 + c2
```

```
'textHello world!'
```

--


```python
b2 + ' ' + c2
```

```
'text Hello world!'
```

---

#### 문자 변수는 연산 불가


```python
b2 + 2
```

--


```
can only concatenate str (not "int") to str
```

---


name: function
class: title1

함수

---


```python
a = [1, 2, 3]
a
```

```
[1, 2, 3]
```

--



```python
sum(a)  # 합계
```

```
6
```

--


```python
max(a)  # 최대값
```

```
3
```

```python
min(a)  # 최소값
```

```
1
```

```python
len(a)  # 길이
```

```
3
```

---

#### 함수의 결과물로 새 변수 만들기


```python
x_sum = sum(a)
x_sum
```

```
6
```



```python
x_max = max(a)
x_max
```

```
3
```

---
name: package
class: title1

패키지

---

#### 저장하기

- 노트북 저장하기
- 다시 열기

---





```python
mpg.head()
```

```
name 'mpg' is not defined
```

--


```python
mpg = pd.read_csv('mpg.csv')
```

```
name 'pd' is not defined
```

---

#### import


```python
import pandas as pd
mpg = pd.read_csv('mpg.csv')
mpg.head()
```

```
  manufacturer model  displ  year  cyl       trans drv  cty  hwy fl category
0         audi    a4    1.8  1999    4    auto(l5)   f   18   29  p  compact
1         audi    a4    1.8  1999    4  manual(m5)   f   21   29  p  compact
2         audi    a4    2.0  2008    4  manual(m6)   f   20   31  p  compact
3         audi    a4    2.0  2008    4    auto(av)   f   21   30  p  compact
4         audi    a4    2.8  1999    6    auto(l5)   f   16   26  p  compact
```


---

#### import




```python
sns.histplot(x = mpg['hwy'])
```

```
name 'sns' is not defined
```

---

#### import


```python
import seaborn as sns
sns.histplot(x = mpg['hwy'])
```

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-46-7.png" width="50%" /&gt;

---

#### 내장 함수와 패키지 함수


.pull-left[
##### 내장 함수


```python
sum()
max()
```

- function()
]



.pull-right[

##### 패키지 함수


```python
pd.read_csv()
pd.value_counts()
```

- package.function()
]



---

#### 패키지 약어 활용하기


```python
import pandas
mpg = pandas.read_csv('mpg.csv')
```

--


```python
import pandas as pd
mpg = pd.read_csv('mpg.csv')
```


---

#### 함수 파라미터(parameter) 지정하기


```python
df = sns.load_dataset('titanic')
df.head()
```

```
   survived  pclass     sex   age  ...  deck  embark_town  alive  alone
0         0       3    male  22.0  ...   NaN  Southampton     no  False
1         1       1  female  38.0  ...     C    Cherbourg    yes  False
2         1       3  female  26.0  ...   NaN  Southampton    yes   True
3         1       1  female  35.0  ...     C  Southampton    yes  False
4         0       3    male  35.0  ...   NaN  Southampton     no   True

[5 rows x 15 columns]
```

---


```python
df.head(n = 10)
```

```
   survived  pclass     sex   age  ...  deck  embark_town  alive  alone
0         0       3    male  22.0  ...   NaN  Southampton     no  False
1         1       1  female  38.0  ...     C    Cherbourg    yes  False
2         1       3  female  26.0  ...   NaN  Southampton    yes   True
3         1       1  female  35.0  ...     C  Southampton    yes  False
4         0       3    male  35.0  ...   NaN  Southampton     no   True
5         0       3    male   NaN  ...   NaN   Queenstown     no   True
6         0       1    male  54.0  ...     E  Southampton     no   True
7         0       3    male   2.0  ...   NaN  Southampton     no  False
8         1       3  female  27.0  ...   NaN  Southampton    yes  False
9         1       2  female  14.0  ...   NaN    Cherbourg    yes  False

[10 rows x 15 columns]
```

--


```python
df.head(n = 3)
```

```
   survived  pclass     sex   age  ...  deck  embark_town  alive  alone
0         0       3    male  22.0  ...   NaN  Southampton     no  False
1         1       1  female  38.0  ...     C    Cherbourg    yes  False
2         1       3  female  26.0  ...   NaN  Southampton    yes   True

[3 rows x 15 columns]
```

---


```python
# x축 class
sns.countplot(data = df, x = 'class')
```

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-54-9.png" width="50%" /&gt;

---


```python
# x축 class, alive별 색 표현
sns.countplot(data = df, x = 'class', hue = 'alive')
```

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-55-11.png" width="50%" /&gt;

---


```python
# y축 class, alive별 색 표현
sns.countplot(data = df, y = 'class', hue = 'alive')
```

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-56-13.png" width="50%" /&gt;

---

#### 함수 사용법이 궁금할 땐 help


```python
sns.countplot?
```


---


#### 자동 완성 기능

- `mpg.` → [Tab] → [Enter]

&lt;img src="img/autocomplation.png" width="50%" /&gt;


---

#### 패키지 모듈 활용하기


&lt;img src="img/module.png" width="80%" /&gt;

---

#### 모듈 함수 사용하기


```python
# sklearn 패키지의 metrics 모듈 로드하기
import sklearn.metrics
sklearn.metrics.accuracy_score()
```

--

##### 모듈명.함수명()으로 사용하기


```python
# sklearn 패키지의 metrics 모듈 로드하기
from sklearn import metrics
metrics.accuracy_score()
```

--

##### 함수명()으로 사용하기


```python
# sklearn.metrics의 accuracy_score() 로드하기
from sklearn.metrics import accuracy_score
accuracy_score()
```



---

name: dataframe
class: title0

&lt;2&gt; 데이터 프레임의 세계로!

---
name: make_dataframe
class: title1

데이터 프레임 만들기

---

#### 데이터 프레임 만들기




```python
import pandas as pd

df = pd.DataFrame({'name'    : ['김지훈', '이유진', '박동현', '김민지'],
                   'english' : [90, 80, 60, 70],
                   'math'    : [50, 60, 100, 20]})
df
```

```
     name  english  math
0  김지훈       90    50
1  이유진       80    60
2  박동현       60   100
3  김민지       70    20
```

---

#### 특정 변수의 값으로 연산하기


#### 1. 특정 변수의 값만 추출



```python
df['english']
```

```
0    90
1    80
2    60
3    70
Name: english, dtype: int64
```

--

#### 2. 함수에 적용


```python
sum(df['english'])      # 합계
```

```
300
```

--


```python
sum(df['english']) / 4  # 평균
```

```
75.0
```

---


#### Q. `math` 합계와 평균 구하기

--

##### (1) 추출


```python
df['math']
```

```
0     50
1     60
2    100
3     20
Name: math, dtype: int64
```

&lt;br-back-10&gt;
--

##### (2) 합계


```python
sum(df['math'])
```

```
230
```

--

##### (3) 평균


```python
sum(df['math']) / 4
```

```
57.5
```

---

name: read_file
class: title1

외부 데이터 가져오기

---

#### 엑셀 파일 불러오기



```python
df_exam = pd.read_excel('excel_exam.xlsx')
df_exam
```

&lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#FF7333;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"&gt;&lt;/path&gt;&lt;/svg&gt;  워킹 디렉터리에 불러올 파일이 있어야 함
  - 확인: `!cd`

---

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```



---

##### Q. math 평균 구하기

&lt;br10&gt;

--


```python
sum(df_exam['math']) / 20
```

```
57.45
```

---

- `len()` 활용하기


```python
# 변수의 값 개수 구하기
x = [1, 2, 3, 4, 5]
x
```

```
[1, 2, 3, 4, 5]
```



```python
len(x)
```

```
5
```

---

- `len()` 활용하기


```python
# 데이터 프레임의 행 개수 구하기
df = pd.DataFrame({'a' : [1, 2, 3],
                   'b' : [4, 5, 6]})
df
```

```
   a  b
0  1  4
1  2  5
2  3  6
```



```python
len(df)
```

```
3
```


---

- `len()` 활용하기


```python
sum(df_exam['math']) / 20
```

```
57.45
```


```python
sum(df_exam['math']) / len(df_exam)
```

```
57.45
```

---

##### Q. `len()` 활용하기: english, science 평균 각각 구하기

&lt;br10&gt;

--


```python
sum(df_exam['english']) / len(df_exam)
```

```
84.9
```


```python
sum(df_exam['science']) / len(df_exam)
```

```
59.45
```

---

##### 엑셀 파일의 첫 번째 행이 변수명이 아니라면?


```python
df_exam_novar = pd.read_excel('excel_exam_novar.xlsx')
df_exam_novar
```

```
   1  1.1  50  98  50.1
0  2    1  60  97    60
1  3    2  25  80    65
2  4    2  50  89    98
3  5    3  20  98    15
4  6    3  50  98    45
5  7    4  46  98    65
6  8    4  48  87    12
```

---

##### 엑셀 파일의 첫 번째 행이 변수명이 아니라면?


```python
df_exam_novar = pd.read_excel('excel_exam_novar.xlsx', header = None)
df_exam_novar
```

```
   0  1   2   3   4
0  1  1  50  98  50
1  2  1  60  97  60
2  3  2  25  80  65
3  4  2  50  89  98
4  5  3  20  98  15
5  6  3  50  98  45
6  7  4  46  98  65
7  8  4  48  87  12
```

---

##### 엑셀 파일에 시트가 여러 개 있다면?


```python
# Sheet2 시트의 데이터 불러오기
df_exam = pd.read_excel('excel_exam.xlsx', sheet_name = 'Sheet2')

# 세 번째 시트의 데이터 불러오기
df_exam = pd.read_excel('excel_exam.xlsx', sheet_name = 2)
```


---


#### CSV 파일 불러오기

&lt;br-back-20&gt;
.pull-left[


```python
pd.read_csv('exam.csv')
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```
]

.pull-right[
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

- 범용 데이터 형식, 다양한 소프트웨어에서 사용
- 값 사이를 쉼표(,)로 구분
- 용량 작음
]

---




```python
exam
```

```
name 'exam' is not defined
```

---


```python
exam = pd.read_csv('exam.csv')
exam
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---

name: write_file
class: title1

데이터 프레임을
CSV 파일로 저장하기

---

#### 데이터 프레임을 CSV 파일로 저장하기


```python
df_exam.to_csv('output_newdata.csv')
```

--

##### index 제거


```python
df_exam.to_csv('output_newdata2.csv', index = False)
```







---



name: basic
class: title0

&lt;3&gt; 데이터 분석 기초

---

name: eda
class: title1

데이터 파악하기

---

### 데이터 파악하기


.left[

| &amp;nbsp;&amp;nbsp;함수       | &amp;nbsp;기능                           |
|------------|--------------------------------------------------|
| &amp;nbsp;&amp;nbsp;head()     | &amp;nbsp;&amp;nbsp;앞부분 출력              |
| &amp;nbsp;&amp;nbsp;tail()     | &amp;nbsp;&amp;nbsp;뒷부분 출력              |
| &amp;nbsp;&amp;nbsp;shape      | &amp;nbsp;&amp;nbsp;행, 열 개수 출력         |
| &amp;nbsp;&amp;nbsp;info()     | &amp;nbsp;&amp;nbsp;변수 속성 출력           |
| &amp;nbsp;&amp;nbsp;describe() | &amp;nbsp;&amp;nbsp;요약 통계량 출력 &amp;nbsp;  |

]


---

##### 데이터 준비하기


```python
exam = pd.read_csv('exam.csv')
exam
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---

#### df.head() - 데이터 앞부분 확인하기

```python
exam.head()    # 앞에서부터 5행까지 출력
```

```
   id  nclass  math  english  science
0   1       1    50       98       50
1   2       1    60       97       60
2   3       1    45       86       78
3   4       1    30       98       58
4   5       2    25       80       65
```

```python
exam.head(10)  # 앞에서부터 10행까지 출력
```

```
   id  nclass  math  english  science
0   1       1    50       98       50
1   2       1    60       97       60
2   3       1    45       86       78
3   4       1    30       98       58
4   5       2    25       80       65
5   6       2    50       89       98
6   7       2    80       90       45
7   8       2    90       78       25
8   9       3    20       98       15
9  10       3    50       98       45
```

---

#### df.tail() - 데이터 뒷부분 확인하기


```python
exam.tail()    # 뒤에서부터 5행까지 출력
```

```
    id  nclass  math  english  science
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

```python
exam.tail(10)  # 뒤에서부터 10행까지 출력
```

```
    id  nclass  math  english  science
10  11       3    65       65       65
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---

#### df.shape - 몇 행 몇 열로 구성되는지 알아보기


```python
exam.shape  # 행, 열 출력
```

```
(20, 5)
```


---

#### df.info() - 속성 파악하기


```python
exam.info()  # 데이터 속성 확인
```

```
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 20 entries, 0 to 19
Data columns (total 5 columns):
 #   Column   Non-Null Count  Dtype
---  ------   --------------  -----
 0   id       20 non-null     int64
 1   nclass   20 non-null     int64
 2   math     20 non-null     int64
 3   english  20 non-null     int64
 4   science  20 non-null     int64
dtypes: int64(5)
memory usage: 932.0 bytes
```

--

- 변수 속성: int64(정수), float64(실수), object(문자), datetime64(날짜 시간)


- 64: 64비트
    - 1 비트로 두 개의 값 표현 가능
    - int64: 2^64개의 정수 표현 가능


- `Non-Null Count`: 결측치(누락된 값)를 제외하고 구한 값의 개수

---

#### df.describe() - 요약 통계량 산출하기


```python
exam.describe()  # 요약 통계량 출력
```

```
             id     nclass       math    english    science
count  20.00000  20.000000  20.000000  20.000000  20.000000
mean   10.50000   3.000000  57.450000  84.900000  59.450000
std     5.91608   1.450953  20.299015  12.875517  25.292968
min     1.00000   1.000000  20.000000  56.000000  12.000000
25%     5.75000   2.000000  45.750000  78.000000  45.000000
50%    10.50000   3.000000  54.000000  86.500000  62.500000
75%    15.25000   4.000000  75.750000  98.000000  78.000000
max    20.00000   5.000000  90.000000  98.000000  98.000000
```

---

#### Q. mpg 데이터 파악하기


```python
# mpg 데이터 불러오기
mpg = pd.read_csv('mpg.csv')
```

---


```python
mpg.head()  # 데이터 앞부분 확인
```

```
  manufacturer model  displ  year  cyl       trans drv  cty  hwy fl category
0         audi    a4    1.8  1999    4    auto(l5)   f   18   29  p  compact
1         audi    a4    1.8  1999    4  manual(m5)   f   21   29  p  compact
2         audi    a4    2.0  2008    4  manual(m6)   f   20   31  p  compact
3         audi    a4    2.0  2008    4    auto(av)   f   21   30  p  compact
4         audi    a4    2.8  1999    6    auto(l5)   f   16   26  p  compact
```



```python
mpg.tail()  # 데이터 뒷부분 확인
```

```
    manufacturer   model  displ  year  cyl  ... drv cty  hwy  fl category
229   volkswagen  passat    2.0  2008    4  ...   f  19   28   p  midsize
230   volkswagen  passat    2.0  2008    4  ...   f  21   29   p  midsize
231   volkswagen  passat    2.8  1999    6  ...   f  16   26   p  midsize
232   volkswagen  passat    2.8  1999    6  ...   f  18   26   p  midsize
233   volkswagen  passat    3.6  2008    6  ...   f  17   26   p  midsize

[5 rows x 11 columns]
```

---

```python
mpg.shape  # 행, 열 출력
```

```
(234, 11)
```

---


```python
mpg.info()  # 데이터 속성 확인
```

```
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 234 entries, 0 to 233
Data columns (total 11 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   manufacturer  234 non-null    object 
 1   model         234 non-null    object 
 2   displ         234 non-null    float64
 3   year          234 non-null    int64  
 4   cyl           234 non-null    int64  
 5   trans         234 non-null    object 
 6   drv           234 non-null    object 
 7   cty           234 non-null    int64  
 8   hwy           234 non-null    int64  
 9   fl            234 non-null    object 
 10  category      234 non-null    object 
dtypes: float64(1), int64(4), object(6)
memory usage: 20.2+ KB
```

---


```python
mpg.describe() # 요약 통계량 출력
```

```
            displ         year         cyl         cty         hwy
count  234.000000   234.000000  234.000000  234.000000  234.000000
mean     3.471795  2003.500000    5.888889   16.858974   23.440171
std      1.291959     4.509646    1.611534    4.255946    5.954643
min      1.600000  1999.000000    4.000000    9.000000   12.000000
25%      2.400000  1999.000000    4.000000   14.000000   18.000000
50%      3.300000  2003.500000    6.000000   17.000000   24.000000
75%      4.600000  2008.000000    8.000000   19.000000   27.000000
max      7.000000  2008.000000    8.000000   35.000000   44.000000
```
---


```python
mpg.describe(include = 'all')  # 문자 변수 요약 통계량 함께 출력
```

```
       manufacturer        model       displ  ...         hwy   fl category
count           234          234  234.000000  ...  234.000000  234      234
unique           15           38         NaN  ...         NaN    5        7
top           dodge  caravan 2wd         NaN  ...         NaN    r      suv
freq             37           11         NaN  ...         NaN  168       62
mean            NaN          NaN    3.471795  ...   23.440171  NaN      NaN
std             NaN          NaN    1.291959  ...    5.954643  NaN      NaN
min             NaN          NaN    1.600000  ...   12.000000  NaN      NaN
25%             NaN          NaN    2.400000  ...   18.000000  NaN      NaN
50%             NaN          NaN    3.300000  ...   24.000000  NaN      NaN
75%             NaN          NaN    4.600000  ...   27.000000  NaN      NaN
max             NaN          NaN    7.000000  ...   44.000000  NaN      NaN

[11 rows x 11 columns]
```

---

class: title1

함수, 메서드, 어트리뷰트

---

#### 함수와 메서드

&lt;br&gt;

&lt;img src="img/function_types.png" width="80%" /&gt;

--

##### 1. 내장 함수


```python
sum(var)
max(var)
```

--

##### 2. 패키지 함수


```python
import pandas as pd 
pd.read_csv('exam.csv') 
pd.DataFrame({'x' : [1, 2, 3]})
```

---

#### 함수와 메서드

&lt;br&gt;

&lt;img src="img/function_types.png" width="80%" /&gt;


##### 3. 메서드(Method)

&lt;br10&gt;

- 변수가 지니고 있는 함수


```python
df.head() 
df.info()
```

---

- 변수의 자료 구조에 따라 사용 가능한 메서드가 다르다


```python
df = pd.read_csv('exam.csv') 
df.head()
```

```
   id  nclass  math  english  science
0   1       1    50       98       50
1   2       1    60       97       60
2   3       1    45       86       78
3   4       1    30       98       58
4   5       2    25       80       65
```



```python
var = [1, 2, 3] 
var.head()
```

```
'list' object has no attribute 'head'
```

---

##### 4. 어트리뷰트(Attribute)

&lt;br10&gt;

- 변수가 지니고 있는 값

.pull-left[

```python
# 메서드
df.head()
```

```
   id  nclass  math  english  science
0   1       1    50       98       50
1   2       1    60       97       60
2   3       1    45       86       78
3   4       1    30       98       58
4   5       2    25       80       65
```
]

.pull-right[


```python
# 어트리뷰트
df.shape
```

```
(20, 5)
```
]


---

- 메서드와 어트리뷰트의 차이


```python
df.head()  # 메서드
df.shape   # 어트리뷰트
```

&lt;img src="img/method_attribute.png" width="60%" /&gt;

---


- 변수의 자료 구조에 따라 지니고 있는 어트리뷰트가 다르다


```python
df.shape
```

```
(20, 5)
```

```python
var.shape
```

```
'list' object has no attribute 'shape'
```

---


name: rename
class: title1

데이터 수정하기:
변수명 바꾸기

---

#### 데이터 프레임 만들기


```python
df_raw = pd.DataFrame({'var1' : [1, 2, 1],
                       'var2' : [2, 3, 2]})
df_raw
```

```
   var1  var2
0     1     2
1     2     3
2     1     2
```

--

#### 데이터 프레임 복사본 만들기


```python
df_new = df_raw.copy()  # 복사본 만들기
df_new                  # 출력
```

```
   var1  var2
0     1     2
1     2     3
2     1     2
```

---

#### 변수명 바꾸기: `df.rename()`


```python
df_new = df_new.rename(columns = {'var2' : 'v2'})  # var2를 v2로 수정
df_new
```

```
   var1  v2
0     1   2
1     2   3
2     1   2
```

--

#### 원본과 비교


```python
df_raw
```

```
   var1  var2
0     1     2
1     2     3
2     1     2
```



---

### 혼자서 해보기



**`mpg` 데이터를 이용해서 분석 문제를 해결해 보세요.**

`mpg` 데이터의 변수명은 긴 단어를 짧게 줄인 축약어로 되어있습니다. `cty` 변수는 도시 연비, `hwy` 변수는 &lt;br&gt; 고속도로 연비를 의미합니다. 변수명을 이해하기 쉬운 단어로 바꾸려고 합니다. `mpg.csv`를 이용해서 아래 문제를 해결해 보세요.

Q1. `mpg.csv`를 불러와 복사본을 만드세요.

Q2. 복사본 데이터를 이용해서 `cty`는 `city`로, `hwy`는 `highway`로 변수명을 수정하세요.

Q3. 데이터 일부를 출력해 변수명이 바뀌었는지 확인해 보세요. 아래와 같은 결과물이 출력되어야 합니다.

&lt;!-- 코드 없이 결과물만 출력 --&gt;

```
  manufacturer model  displ  year  cyl  ... drv city  highway  fl category
0         audi    a4    1.8  1999    4  ...   f   18       29   p  compact
1         audi    a4    1.8  1999    4  ...   f   21       29   p  compact
2         audi    a4    2.0  2008    4  ...   f   20       31   p  compact
3         audi    a4    2.0  2008    4  ...   f   21       30   p  compact
4         audi    a4    2.8  1999    6  ...   f   16       26   p  compact

[5 rows x 11 columns]
```

---

Q1. `mpg.csv`를 불러와 복사본을 만드세요.

```python
mpg = pd.read_csv('mpg.csv')  # mpg 데이터 불러오기
mpg_new = mpg.copy()          # 복사본 만들기
```

---

Q2. 복사본 데이터를 이용해서 `cty`는 `city`로, `hwy`는 `highway`로 변수명을 수정하세요.


```python
mpg_new = mpg_new.rename(columns = {'cty' : 'city'})     # cty를 city로 수정
mpg_new = mpg_new.rename(columns = {'hwy' : 'highway'})  # hwy를 highway로 수정
```

--

&lt;br&gt;

Q3. 데이터 일부를 출력해 변수명이 바뀌었는지 확인해 보세요. 아래와 같은 결과물이 출력되어야 합니다.

```python
mpg_new.head()  # 데이터 일부 출력
```

```
  manufacturer model  displ  year  cyl  ... drv city  highway  fl category
0         audi    a4    1.8  1999    4  ...   f   18       29   p  compact
1         audi    a4    1.8  1999    4  ...   f   21       29   p  compact
2         audi    a4    2.0  2008    4  ...   f   20       31   p  compact
3         audi    a4    2.0  2008    4  ...   f   21       30   p  compact
4         audi    a4    2.8  1999    6  ...   f   16       26   p  compact

[5 rows x 11 columns]
```

---

&lt;svg viewBox="0 0 352 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M176 80c-52.94 0-96 43.06-96 96 0 8.84 7.16 16 16 16s16-7.16 16-16c0-35.3 28.72-64 64-64 8.84 0 16-7.16 16-16s-7.16-16-16-16zM96.06 459.17c0 3.15.93 6.22 2.68 8.84l24.51 36.84c2.97 4.46 7.97 7.14 13.32 7.14h78.85c5.36 0 10.36-2.68 13.32-7.14l24.51-36.84c1.74-2.62 2.67-5.7 2.68-8.84l.05-43.18H96.02l.04 43.18zM176 0C73.72 0 0 82.97 0 176c0 44.37 16.45 84.85 43.56 115.78 16.64 18.99 42.74 58.8 52.42 92.16v.06h48v-.12c-.01-4.77-.72-9.51-2.15-14.07-5.59-17.81-22.82-64.77-62.17-109.67-20.54-23.43-31.52-53.15-31.61-84.14-.2-73.64 59.67-128 127.95-128 70.58 0 128 57.42 128 128 0 30.97-11.24 60.85-31.65 84.14-39.11 44.61-56.42 91.47-62.1 109.46a47.507 47.507 0 0 0-2.22 14.3v.1h48v-.05c9.68-33.37 35.78-73.18 52.42-92.16C335.55 260.85 352 220.37 352 176 352 78.8 273.2 0 176 0z"&gt;&lt;/path&gt;&lt;/svg&gt; 여러 변수명 한 번에 바꾸기


```python
mpg_new = mpg.rename(columns = {'cty' : 'city',
                                'hwy' : 'highway'})
```

---
name: derived_variable
class: title1

데이터 수정하기:
파생변수 만들기

---

&lt;br&gt;
.center[
## 파생변수 만들기
]

&lt;br&gt;
&lt;img src="img/new_var.png" width="600px" style="display: block; margin: auto;" /&gt;

---

#### 데이터 프레임 만들기


```python
df = pd.DataFrame({'var1' : [4, 3, 8],
                   'var2' : [2, 6, 1]})
df
```

```
   var1  var2
0     4     2
1     3     6
2     8     1
```

---

#### 파생변수 만들기

```python
df['var_sum'] = df['var1'] + df['var2']  # var_sum 파생변수 생성
df
```

```
   var1  var2  var_sum
0     4     2        6
1     3     6        9
2     8     1        9
```

--

#### Q. `var_mean` 만들기

--


```python
df['var_mean'] = (df['var1'] + df['var2']) / 2  # var_mean 파생변수 생성
df
```

```
   var1  var2  var_sum  var_mean
0     4     2        6       3.0
1     3     6        9       4.5
2     8     1        9       4.5
```

---

#### mpg에 적용하기

- 통합 연비 변수 만들기

--



```python
mpg['total'] = (mpg['cty'] + mpg['hwy']) / 2  # 통합 연비 변수 생성
mpg.head()
```

```
  manufacturer model  displ  year  cyl  ... cty hwy  fl  category total
0         audi    a4    1.8  1999    4  ...  18  29   p   compact  23.5
1         audi    a4    1.8  1999    4  ...  21  29   p   compact  25.0
2         audi    a4    2.0  2008    4  ...  20  31   p   compact  25.5
3         audi    a4    2.0  2008    4  ...  21  30   p   compact  25.5
4         audi    a4    2.8  1999    6  ...  16  26   p   compact  21.0

[5 rows x 12 columns]
```

---



```python
mpg.info()
```

```
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 234 entries, 0 to 233
Data columns (total 12 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   manufacturer  234 non-null    object 
 1   model         234 non-null    object 
 2   displ         234 non-null    float64
 3   year          234 non-null    int64  
 4   cyl           234 non-null    int64  
 5   trans         234 non-null    object 
 6   drv           234 non-null    object 
 7   cty           234 non-null    int64  
 8   hwy           234 non-null    int64  
 9   fl            234 non-null    object 
 10  category      234 non-null    object 
 11  total         234 non-null    float64
dtypes: float64(2), int64(4), object(6)
memory usage: 22.1+ KB
```

---

- `total` 평균 구하기: 합계를 행 수로 나누기


```python
sum(mpg['total']) / len(mpg) 
```

```
20.14957264957265
```

--


&lt;br&gt;

- `total` 평균 구하기: `df.mean()` 활용하기


```python
mpg['total'].mean()
```

```
20.14957264957265
```

---

name: np.where
class: title1

데이터 수정하기:  
조건 함수로 파생 변수 만들기

---

#### 기준값 정하기


```python
mpg['total'].describe()  # 요약 통계량 산출
```



```
count    234.000000
mean      20.149573
std        5.050290
min       10.500000
25%       15.500000
50%       20.500000
75%       23.500000
max       39.500000
Name: total, dtype: float64
```


---


```python
mpg['total'].plot.hist()  # 히스토그램 생성
```

&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-138-1.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-138-2.png" width="50%" /&gt;



---

#### 조건 함수로 합격 판정 변수 만들기

&lt;img src="img/np.where.png" width="80%" /&gt;


```python
import numpy as np

# 20 이상이면 pass, 그렇지 않으면 fail 부여
mpg['test'] = np.where(mpg['total'] &gt;= 20, 'pass', 'fail')
```

---


```python
mpg.head(20)
```

```
   manufacturer               model  displ  year  ...  fl category total  test
0          audi                  a4    1.8  1999  ...   p  compact  23.5  pass
1          audi                  a4    1.8  1999  ...   p  compact  25.0  pass
2          audi                  a4    2.0  2008  ...   p  compact  25.5  pass
3          audi                  a4    2.0  2008  ...   p  compact  25.5  pass
4          audi                  a4    2.8  1999  ...   p  compact  21.0  pass
5          audi                  a4    2.8  1999  ...   p  compact  22.0  pass
6          audi                  a4    3.1  2008  ...   p  compact  22.5  pass
7          audi          a4 quattro    1.8  1999  ...   p  compact  22.0  pass
8          audi          a4 quattro    1.8  1999  ...   p  compact  20.5  pass
9          audi          a4 quattro    2.0  2008  ...   p  compact  24.0  pass
10         audi          a4 quattro    2.0  2008  ...   p  compact  23.0  pass
11         audi          a4 quattro    2.8  1999  ...   p  compact  20.0  pass
12         audi          a4 quattro    2.8  1999  ...   p  compact  21.0  pass
13         audi          a4 quattro    3.1  2008  ...   p  compact  21.0  pass
14         audi          a4 quattro    3.1  2008  ...   p  compact  20.0  pass
15         audi          a6 quattro    2.8  1999  ...   p  midsize  19.5  fail
16         audi          a6 quattro    3.1  2008  ...   p  midsize  21.0  pass
17         audi          a6 quattro    4.2  2008  ...   p  midsize  19.5  fail
18    chevrolet  c1500 suburban 2wd    5.3  2008  ...   r      suv  17.0  fail
19    chevrolet  c1500 suburban 2wd    5.3  2008  ...   e      suv  13.0  fail

[20 rows x 13 columns]
```

---

#### 빈도표, 막대 그래프로 합격 판정 자동차 수 살펴보기


```python
mpg['test'].value_counts()  # 연비 합격 빈도표 만들기
```

```
test
pass    128
fail    106
Name: count, dtype: int64
```

--


```python
count_test = mpg['test'].value_counts()  # 연비 합격 빈도표를 변수에 할당
count_test.plot.bar()                    # 빈도 막대 그래프 만들기
```


&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-144-1.png" width="30%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-144-2.png" width="30%" /&gt;

---


```python
count_test.plot.bar(rot = 0)  # 축 이름 수평으로 만들기
```

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-146-5.png" width="30%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-146-6.png" width="30%" /&gt;



---

### 중첩 조건문 활용하기 - 연비 등급 변수 만들기

.left[

&amp;nbsp; 등급|&amp;nbsp; &amp;nbsp;total 기준
----|---
&amp;nbsp; &amp;nbsp; A &amp;nbsp; &amp;nbsp;   |&amp;nbsp; &amp;nbsp; 30 이상 &amp;nbsp; &amp;nbsp;
&amp;nbsp; &amp;nbsp; B &amp;nbsp; &amp;nbsp;   |&amp;nbsp; &amp;nbsp; 20~29 &amp;nbsp; &amp;nbsp;
&amp;nbsp; &amp;nbsp; C &amp;nbsp; &amp;nbsp;   |&amp;nbsp; &amp;nbsp; 20 미만 &amp;nbsp; &amp;nbsp;

]
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

--


```python
# total 기준으로 A, B, C 등급 부여
mpg['grade'] = np.where(mpg['total'] &gt;= 30, 'A',
               np.where(mpg['total'] &gt;= 20, 'B', 'C'))
```

&lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#FF7333;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"&gt;&lt;/path&gt;&lt;/svg&gt; `np.where()`가 두 번 반복되므로 열리는 괄호와 닫히는 괄호가 각각 두 개, 쉼표도 각각 두 개

---


```python
mpg.head(20)
```

```
   manufacturer               model  displ  year  ...  category total  test  grade
0          audi                  a4    1.8  1999  ...   compact  23.5  pass      B
1          audi                  a4    1.8  1999  ...   compact  25.0  pass      B
2          audi                  a4    2.0  2008  ...   compact  25.5  pass      B
3          audi                  a4    2.0  2008  ...   compact  25.5  pass      B
4          audi                  a4    2.8  1999  ...   compact  21.0  pass      B
5          audi                  a4    2.8  1999  ...   compact  22.0  pass      B
6          audi                  a4    3.1  2008  ...   compact  22.5  pass      B
7          audi          a4 quattro    1.8  1999  ...   compact  22.0  pass      B
8          audi          a4 quattro    1.8  1999  ...   compact  20.5  pass      B
9          audi          a4 quattro    2.0  2008  ...   compact  24.0  pass      B
10         audi          a4 quattro    2.0  2008  ...   compact  23.0  pass      B
11         audi          a4 quattro    2.8  1999  ...   compact  20.0  pass      B
12         audi          a4 quattro    2.8  1999  ...   compact  21.0  pass      B
13         audi          a4 quattro    3.1  2008  ...   compact  21.0  pass      B
14         audi          a4 quattro    3.1  2008  ...   compact  20.0  pass      B
15         audi          a6 quattro    2.8  1999  ...   midsize  19.5  fail      C
16         audi          a6 quattro    3.1  2008  ...   midsize  21.0  pass      B
17         audi          a6 quattro    4.2  2008  ...   midsize  19.5  fail      C
18    chevrolet  c1500 suburban 2wd    5.3  2008  ...       suv  17.0  fail      C
19    chevrolet  c1500 suburban 2wd    5.3  2008  ...       suv  13.0  fail      C

[20 rows x 14 columns]
```

---

#### Q. 빈도표, 막대 그래프로 연비 등급 살펴보기

--



```python
count_grade = mpg['grade'].value_counts()  # 등급 빈도표 생성
count_grade
```

```
grade
B    118
C    106
A     10
Name: count, dtype: int64
```


```python
count_grade.plot.bar(rot = 0)  # 빈도 막대 그래프 생성
```

&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-151-9.png" width="30%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-151-10.png" width="30%" /&gt;


---

#### 알파벳 순으로 막대 정렬하기






```python
# 등급 빈도표 알파벳 순 정렬
count_grade = mpg['grade'].value_counts().sort_index()
count_grade
```

```
grade
A     10
B    118
C    106
Name: count, dtype: int64
```

---

#### 알파벳 순으로 막대 정렬하기



```python
# 등급 빈도 막대 그래프 만들기
count_grade.plot.bar(rot = 0)
```

&lt;br-back-20&gt;


&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-155-13.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-155-14.png" width="50%" /&gt;


---
#### 원하는 만큼 범주 만들기: 범주 개수 - 1

.left[
등급|total 기준
:----:|:---:
&amp;nbsp; &amp;nbsp; &amp;nbsp; A &amp;nbsp;&amp;nbsp; &amp;nbsp;    |&amp;nbsp; &amp;nbsp; 30 이상&amp;nbsp; &amp;nbsp;
&amp;nbsp; &amp;nbsp; &amp;nbsp; B &amp;nbsp;&amp;nbsp; &amp;nbsp;    |&amp;nbsp; &amp;nbsp; 25 이상&amp;nbsp; &amp;nbsp;
&amp;nbsp; &amp;nbsp; &amp;nbsp; C &amp;nbsp;&amp;nbsp; &amp;nbsp;    |&amp;nbsp; &amp;nbsp; 20 이상&amp;nbsp; &amp;nbsp;
&amp;nbsp; &amp;nbsp; &amp;nbsp; D &amp;nbsp;&amp;nbsp; &amp;nbsp;    |&amp;nbsp; &amp;nbsp; 20 미만&amp;nbsp; &amp;nbsp;
]

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;


```python
# A, B, C, D 등급 부여
mpg['grade2'] = np.where(mpg['total'] &gt;= 30, 'A',
                np.where(mpg['total'] &gt;= 25, 'B',
                np.where(mpg['total'] &gt;= 20, 'C', 'D')))
```

---

#### 목록에 해당하는 행으로 변수 만들기


```python
mpg['size'] = np.where((mpg['category'] == 'compact') |
                       (mpg['category'] == 'subcompact') |
                       (mpg['category'] == '2seater'),
                       'small', 'large')
                       
mpg['size'].value_counts()
```

```
size
large    147
small     87
Name: count, dtype: int64
```

---

#### 목록에 해당하는 행으로 변수 만들기 - `df.isin()`

.small-95[

```python
mpg['size'] = np.where(mpg['category'].isin(['compact', 'subcompact', '2seater']), 
                       'small', 'large')

mpg['size'].value_counts()
```

```
size
large    147
small     87
Name: count, dtype: int64
```
]

---

### 정리하기


```python
# 1. 패키지 로드
import pandas as pd
import numpy as np

# 2. 데이터 불러오기
mpg = pd.read_csv('mpg.csv')

# 3. 데이터 파악
mpg.head()      # 데이터 앞부분
mpg.tail()      # 데이터 뒷부분
mpg.shape       # 행, 열 수
mpg.info()      # 속성
mpg.describe()  # 요약 통계량
```

---


```python
# 4. 변수명 수정
mpg = mpg.rename(columns = {'manufacturer' : 'company'})

# 5. 파생변수 생성
mpg['total'] = (mpg['cty'] + mpg['hwy']) / 2                # 변수 조합
mpg['test'] = np.where(mpg['total'] &gt;= 20, 'pass', 'fail')  # 조건문 활용

# 6. 빈도 확인
count_test = mpg['test'].value_counts()                     # 빈도표
count_test.plot.bar(rot = 0)                                # 빈도 막대 그래프
```

---

class: title1

분석 도전

---

### 분석 도전

**`midwest` 데이터는 미국 동북중부 437개 지역의 인구통계 정보를 담고 있습니다. `midwest.csv`를 &lt;br&gt;이용해서 데이터 분석 문제를 해결해보세요.**

Q1. `midwest.csv`를 불러와 데이터의 특징을 파악하세요.

Q2. `poptotal`(전체 인구) 변수를 `total`로, `popasian`(아시아 인구) 변수를 `asian`으로 변수명을 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 수정하세요.

Q3. `total`, `asian` 변수를 이용해서 '전체 인구 대비 아시아 인구 백분율' 파생변수를 추가하고, &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 히스토그램을 만들어 분포를 살펴보세요.

Q4. 아시아 인구 백분율 전체 평균을 초과하면 `'large'`, 그 외에는 `'small'`을 부여한 파생변수를 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;만드세요.

Q5.`'large'`와 `'small'`에 해당하는 지역이 얼마나 되는지, 빈도표와 빈도 막대 그래프를 만들어 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 확인해보세요.



---

Q1. `midwest.csv`를 불러와 데이터의 특징을 파악하세요.


```python
midwest = pd.read_csv('midwest.csv')
midwest.head()
midwest.tail()
midwest.shape
midwest.info()
midwest.describe()
```



---

Q2. `poptotal`(전체 인구) 변수를 `total`로, `popasian`(아시아 인구) 변수를 `asian`으로 변수명을 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 수정하세요.


```python
midwest = midwest.rename(columns = {'poptotal' : 'total'})
midwest = midwest.rename(columns = {'popasian' : 'asian'})
midwest.info()
```

&lt;br-10&gt;

.scroll-box-20[

```
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 437 entries, 0 to 436
Data columns (total 28 columns):
 #   Column                Non-Null Count  Dtype  
---  ------                --------------  -----  
 0   PID                   437 non-null    int64  
 1   county                437 non-null    object 
 2   state                 437 non-null    object 
 3   area                  437 non-null    float64
 4   total                 437 non-null    int64  
 5   popdensity            437 non-null    float64
 6   popwhite              437 non-null    int64  
 7   popblack              437 non-null    int64  
 8   popamerindian         437 non-null    int64  
 9   asian                 437 non-null    int64  
 10  popother              437 non-null    int64  
 11  percwhite             437 non-null    float64
 12  percblack             437 non-null    float64
 13  percamerindan         437 non-null    float64
 14  percasian             437 non-null    float64
 15  percother             437 non-null    float64
 16  popadults             437 non-null    int64  
 17  perchsd               437 non-null    float64
 18  percollege            437 non-null    float64
 19  percprof              437 non-null    float64
 20  poppovertyknown       437 non-null    int64  
 21  percpovertyknown      437 non-null    float64
 22  percbelowpoverty      437 non-null    float64
 23  percchildbelowpovert  437 non-null    float64
 24  percadultpoverty      437 non-null    float64
 25  percelderlypoverty    437 non-null    float64
 26  inmetro               437 non-null    int64  
 27  category              437 non-null    object 
dtypes: float64(15), int64(10), object(3)
memory usage: 95.7+ KB
```
]

---

Q3. `total`, `asian` 변수를 이용해서 '전체 인구 대비 아시아 인구 백분율' 파생변수를 추가하고, &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 히스토그램을 만들어 분포를 살펴보세요.


```python
midwest['ratio'] = midwest['asian']/midwest['total']*100
midwest['ratio'].plot.hist()
```

&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-166-17.png" width="40%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-166-18.png" width="40%" /&gt;

---
Q4. 아시아 인구 백분율 전체 평균을 초과하면 `'large'`, 그 외에는 `'small'`을 부여한 파생변수를 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;만드세요.

```python
# ratio 평균
midwest['ratio'].mean()
```

```
0.4872461834357345
```



```python
# large, small 부여
midwest['group'] = np.where(midwest['ratio'] &gt; 0.4872, 'large', 'small')
```

---

Q4. 아시아 인구 백분율 전체 평균을 초과하면 `'large'`, 그 외에는 `'small'`을 부여한 파생변수를 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;만드세요.


```python
# 방법2
m_ratio = midwest['ratio'].mean()
midwest['group'] = np.where(midwest['ratio'] &gt; m_ratio, 'large', 'small')
```

--


```python
# 방법3
midwest['group'] = np.where(midwest['ratio'] &gt; midwest['ratio'].mean(),
                            'large', 'small')
```

---

Q5.`'large'`와 `'small'`에 해당하는 지역이 얼마나 되는지, 빈도표와 빈도 막대 그래프를 만들어 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 확인해보세요.



```python
count_group = midwest['group'].value_counts()
count_group
```

```
group
small    318
large    119
Name: count, dtype: int64
```



```python
count_group.plot.bar(rot = 0)
```

&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-173-21.png" width="30%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-173-22.png" width="30%" /&gt;




---

class: title0

쉽게 배우는 Python 데이터 분석 Part 2

---

name: handling
class: title0

&lt;4&gt; 자유자재로 데이터 가공하기

---

&lt;br&gt;

## .center[자유자재로 데이터 가공하기]

&lt;br&gt;
&lt;img src="img/preprocessing.png" width="600px" style="display: block; margin: auto;" /&gt;

---

#### 데이터 전처리(Preprocessing) - pandas 패키지


.left[
| 함수                      | 기능              |
|---------------------------|-------------------|
| &amp;nbsp;&amp;nbsp;query()       &amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp; 행 추출           &amp;nbsp;&amp;nbsp;|
| &amp;nbsp;&amp;nbsp;df[]          &amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp; 열(변수) 추출     &amp;nbsp;&amp;nbsp;|
| &amp;nbsp;&amp;nbsp;sort_values() &amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp; 정렬              &amp;nbsp;&amp;nbsp;|
| &amp;nbsp;&amp;nbsp;assign()      &amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp; 변수 추가         &amp;nbsp;&amp;nbsp;|
| &amp;nbsp;&amp;nbsp;groupby()     &amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp; 집단별로 나누기   &amp;nbsp;&amp;nbsp;|
| &amp;nbsp;&amp;nbsp;agg()         &amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp; 통계치 구하기     &amp;nbsp;&amp;nbsp;|
| &amp;nbsp;&amp;nbsp;merge()       &amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp; 데이터 합치기(열) &amp;nbsp;&amp;nbsp;|
| &amp;nbsp;&amp;nbsp;concat()      &amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp; 데이터 합치기(행) &amp;nbsp;&amp;nbsp;|
]
---

name: filter
class: title1

조건에 맞는 데이터만 추출하기

---
&lt;br&gt;&lt;br&gt;
### .center[조건에 맞는 데이터만 추출하기]
&lt;br&gt;
&lt;img src="img/filter.png" width="600px" style="display: block; margin: auto;" /&gt;

---


##### 데이터 불러오기

&lt;br-back-10&gt;


```python
import pandas as pd
exam = pd.read_csv('exam.csv')
exam
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---


```python
# exam에서 nclass가 1인 경우만 추출
exam.query('nclass == 1')
```

```
   id  nclass  math  english  science
0   1       1    50       98       50
1   2       1    60       97       60
2   3       1    45       86       78
3   4       1    30       98       58
```


--


```python
# 2반인 경우만 추출
exam.query('nclass == 2')
```

```
   id  nclass  math  english  science
4   5       2    25       80       65
5   6       2    50       89       98
6   7       2    80       90       45
7   8       2    90       78       25
```

---


```python
# 1반이 아닌 경우
exam.query('nclass != 1')
```

```
    id  nclass  math  english  science
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---


```python
# 2반이 아닌 경우
exam.query('nclass != 2')
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---

#### 초과, 미만, 이상, 이하 조건 걸기


```python
# 수학 점수가 50점을 초과한 경우
exam.query('math &gt; 50')
```

```
    id  nclass  math  english  science
1    2       1    60       97       60
6    7       2    80       90       45
7    8       2    90       78       25
10  11       3    65       65       65
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---


```python
# 수학 점수가 50점 미만인 경우
exam.query('math &lt; 50')
```

```
    id  nclass  math  english  science
2    3       1    45       86       78
3    4       1    30       98       58
4    5       2    25       80       65
8    9       3    20       98       15
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
```

---


```python
# 영어 점수가 80점 이상인 경우
exam.query('english &gt;= 80')
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
8    9       3    20       98       15
9   10       3    50       98       45
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
15  16       4    58       98       65
19  20       5    78       83       58
```

---


```python
# 영어 점수가 80점 이하인 경우
exam.query('english &lt;= 80')
```

```
    id  nclass  math  english  science
4    5       2    25       80       65
7    8       2    90       78       25
10  11       3    65       65       65
14  15       4    75       56       78
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
```


---

#### 여러 조건을 충족하는 행 추출하기


```python
# 1반 이면서 수학 점수가 50점 이상인 경우
exam.query('nclass == 1 &amp; math &gt;= 50')
```

```
   id  nclass  math  english  science
0   1       1    50       98       50
1   2       1    60       97       60
```

---


```python
# 2반 이면서 영어 점수가 80점 이상인 경우
exam.query('nclass == 2 &amp; english &gt;= 80')
```

```
   id  nclass  math  english  science
4   5       2    25       80       65
5   6       2    50       89       98
6   7       2    80       90       45
```

---

#### 여러 조건 중 하나 이상 충족하는 행 추출하기


```python
# 수학 점수가 90점 이상이거나 영어 점수가 90점 이상인 경우
exam.query('math &gt;= 90 | english &gt;= 90')
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
3    4       1    30       98       58
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
9   10       3    50       98       45
12  13       4    46       98       65
15  16       4    58       98       65
```

---


```python
# 영어 점수가 90점 미만이거나 과학점수가 50점 미만인 경우
exam.query('english &lt; 90 | science &lt; 50')
```

```
    id  nclass  math  english  science
2    3       1    45       86       78
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
13  14       4    48       87       12
14  15       4    75       56       78
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---

#### 목록에 해당되는 행 추출하기


```python
# 1, 3, 5반 추출
exam.query('nclass == 1 | nclass == 3 | nclass == 5')
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---

#### 목록에 해당되는 행 추출하기


```python
# 1, 3, 5반 추출
exam.query('nclass in [1, 3, 5]')
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---

#### 추출한 행으로 데이터 만들기

##### Q. 1반과 2반의 수학 점수 평균 구하기

--


```python
class1 = exam.query('nclass == 1')  # nclass가 1인 행 추출, class1에 할당
class2 = exam.query('nclass == 2')  # nclass가 2인 행 추출, class2에 할당
```


```python
class1['math'].mean()  # 1반 수학 점수 평균 구하기
```

```
46.25
```

```python
class2['math'].mean()  # 2반 수학 점수 평균 구하기
```

```
61.25
```

---

#### 문자 변수를 이용해 조건에 맞는 행 추출하기

- '전체 조건'과 '추출할 문자'에 서로 다른 모양 따옴표 입력


```python
df = pd.DataFrame({'sex'     : ['F', 'M', 'F', 'M'],
                   'country' : ['Korea', 'China', 'Japan', 'USA']})
df
```

```
  sex country
0   F   Korea
1   M   China
2   F   Japan
3   M     USA
```

---

- 전체 조건에 작은따옴표, 추출할 문자에 큰따옴표 사용

```python
df.query('sex == "F" &amp; country == "Korea"')
```

```
  sex country
0   F   Korea
```

--



- 전체 조건에 큰따옴표, 추출할 문자에 작은따옴표 사용


```python
df.query("sex == 'M' &amp; country == 'China'")
```

```
  sex country
1   M   China
```


--


- **같은 모양 따옴표 사용 X**


```python
# 전체 조건과 추출할 문자에 모두 작은따옴표 사용
df.query('sex == 'F' &amp; country == 'Korea'')
```

    SyntaxError: invalid syntax (&lt;string&gt;, line 1)


---

#### Python에서 사용하는 기호들

&lt;br&gt;

.left[
| 논리 연산자 | 기능        |
|:-----------:|:-----------:|
| &lt;           | 작다        |
| &lt;=          | 작거나 같다 |
| &gt;           | 크다        |
| &gt;=          | 크거나 같다 |
| ==          | 같다        |
| !=          | 같지 않다   |
| &amp;#124;      | 또는        |
| &amp;           | 그리고      |
| in          | 매칭 확인   |

]

.right[
| 산술 연산자 | 기능            |
|:-----------:|:-----------:|
| +           | 더하기          |
| -           | 빼기            |
| *           | 곱하기          |
| **          | 제곱            |
| /           | 나누기          |
| //          | 나눗셈의 몫     |
| %           | 나눗셈의 나머지 |

]

---
### 혼자서 해보기

**`mpg` 데이터를 이용해서 분석 문제를 해결해 보세요.**

Q1. 자동차 배기량에 따라 고속도로 연비가 다른지 알아보려고 합니다. `displ`(배기량)이 `4` 이하인 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;자동차와 `5` 이상인 자동차 중 어떤 자동차의 `hwy`(고속도로 연비)가 평균적으로 더 높은지 알아보세요.

Q2. 자동차 제조 회사에 따라 도시 연비가 다른지 알아보려고 합니다. `'audi'`와 `'toyota'` 중 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;어느 `manufacturer`(자동차 제조 회사)의 `cty`(도시 연비)가 평균적으로 더 높은지 알아보세요.

Q3. `'chevrolet'`, `'ford'`, `'honda'` 자동차의 고속도로 연비 평균을 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 이 회사들의 자동차를 추출한 뒤 `hwy` 전체 평균을 구해보세요.

---

Q1. 자동차 배기량에 따라 고속도로 연비가 다른지 알아보려고 합니다. `displ`(배기량)이 `4` 이하인 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;자동차와 `5` 이상인 자동차 중 어떤 자동차의 `hwy`(고속도로 연비)가 평균적으로 더 높은지 알아보세요.


```python
mpg = pd.read_csv('mpg.csv')     # mpg 데이터 불러오기

mpg_a = mpg.query('displ &lt;= 4')  # displ 4 이하 추출
mpg_b = mpg.query('displ &gt;= 5')  # displ 5 이상 추출
```


```python
mpg_a['hwy'].mean()  # displ 4 이하 hwy 평균
```

```
25.96319018404908
```

```python
mpg_b['hwy'].mean()  # displ 5 이상 hwy 평균
```

```
18.07894736842105
```

---

Q2. 자동차 제조 회사에 따라 도시 연비가 다른지 알아보려고 합니다. `'audi'`와 `'toyota'` 중 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;어느 `manufacturer`(자동차 제조 회사)의 `cty`(도시 연비)가 평균적으로 더 높은지 알아보세요.

```python
mpg_audi   = mpg.query('manufacturer == "audi"')    # audi 추출
mpg_toyota = mpg.query('manufacturer == "toyota"')  # toyota 추출
```



```python
mpg_audi['cty'].mean()    # audi의 cty 평균
```

```
17.61111111111111
```

```python
mpg_toyota['cty'].mean()  # toyota의 cty 평균
```

```
18.529411764705884
```

---

Q3. `'chevrolet'`, `'ford'`, `'honda'` 자동차의 고속도로 연비 평균을 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 이 회사들의 자동차를 추출한 뒤 `hwy` 전체 평균을 구해보세요.

```python
# manufacturer가 chevrolet, ford, honda에 해당하면 추출
mpg_new = mpg.query('manufacturer in ["chevrolet", "ford", "honda"]')
mpg_new['hwy'].mean()
```

```
22.50943396226415
```

---

name: select
class: title1

필요한 변수만 추출하기

---

&lt;br&gt;
### .center[필요한 변수만 추출하기]

&lt;br&gt;
&lt;img src="img/select.png" width="600px" style="display: block; margin: auto;" /&gt;

---


```python
exam
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```

---


```python
exam['math']  # math 추출
```

```
0     50
1     60
2     45
3     30
4     25
5     50
6     80
7     90
8     20
9     50
10    65
11    45
12    46
13    48
14    75
15    58
16    65
17    80
18    89
19    78
Name: math, dtype: int64
```

---


```python
exam['english']  # english 추출
```

```
0     98
1     97
2     86
3     98
4     80
5     89
6     90
7     78
8     98
9     98
10    65
11    85
12    98
13    87
14    56
15    98
16    68
17    78
18    68
19    83
Name: english, dtype: int64
```

---

#### 여러 변수 추출하기


```python
exam[['nclass', 'math', 'english']]  # nclass, math, english 변수 추출
```

```
    nclass  math  english
0        1    50       98
1        1    60       97
2        1    45       86
3        1    30       98
4        2    25       80
5        2    50       89
6        2    80       90
7        2    90       78
8        3    20       98
9        3    50       98
10       3    65       65
11       3    45       85
12       4    46       98
13       4    48       87
14       4    75       56
15       4    58       98
16       5    65       68
17       5    80       78
18       5    89       68
19       5    78       83
```

---

&lt;br-back-10&gt;

&lt;svg viewBox="0 0 352 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M176 80c-52.94 0-96 43.06-96 96 0 8.84 7.16 16 16 16s16-7.16 16-16c0-35.3 28.72-64 64-64 8.84 0 16-7.16 16-16s-7.16-16-16-16zM96.06 459.17c0 3.15.93 6.22 2.68 8.84l24.51 36.84c2.97 4.46 7.97 7.14 13.32 7.14h78.85c5.36 0 10.36-2.68 13.32-7.14l24.51-36.84c1.74-2.62 2.67-5.7 2.68-8.84l.05-43.18H96.02l.04 43.18zM176 0C73.72 0 0 82.97 0 176c0 44.37 16.45 84.85 43.56 115.78 16.64 18.99 42.74 58.8 52.42 92.16v.06h48v-.12c-.01-4.77-.72-9.51-2.15-14.07-5.59-17.81-22.82-64.77-62.17-109.67-20.54-23.43-31.52-53.15-31.61-84.14-.2-73.64 59.67-128 127.95-128 70.58 0 128 57.42 128 128 0 30.97-11.24 60.85-31.65 84.14-39.11 44.61-56.42 91.47-62.1 109.46a47.507 47.507 0 0 0-2.22 14.3v.1h48v-.05c9.68-33.37 35.78-73.18 52.42-92.16C335.55 260.85 352 220.37 352 176 352 78.8 273.2 0 176 0z"&gt;&lt;/path&gt;&lt;/svg&gt; 변수가 1개일 때 데이터 프레임 유지하기

&lt;br-back-20&gt;

.pull-left[

```python
# 시리즈로 추출
exam['math'] 
```

```
0     50
1     60
2     45
3     30
4     25
5     50
6     80
7     90
8     20
9     50
10    65
11    45
12    46
13    48
14    75
15    58
16    65
17    80
18    89
19    78
Name: math, dtype: int64
```
]

--
.pull-right[


```python
# 데이터 프레임으로 추출
exam[['math']] 
```

```
    math
0     50
1     60
2     45
3     30
4     25
5     50
6     80
7     90
8     20
9     50
10    65
11    45
12    46
13    48
14    75
15    58
16    65
17    80
18    89
19    78
```
]

---

#### 변수 제외하기


```python
exam.drop(columns = 'math')  # math 제외
```

```
    id  nclass  english  science
0    1       1       98       50
1    2       1       97       60
2    3       1       86       78
3    4       1       98       58
4    5       2       80       65
5    6       2       89       98
6    7       2       90       45
7    8       2       78       25
8    9       3       98       15
9   10       3       98       45
10  11       3       65       65
11  12       3       85       32
12  13       4       98       65
13  14       4       87       12
14  15       4       56       78
15  16       4       98       65
16  17       5       68       98
17  18       5       78       90
18  19       5       68       87
19  20       5       83       58
```

---

#### 변수 제외하기


```python
exam.drop(columns = ['math', 'english'])  # math, english 제외
```

```
    id  nclass  science
0    1       1       50
1    2       1       60
2    3       1       78
3    4       1       58
4    5       2       65
5    6       2       98
6    7       2       45
7    8       2       25
8    9       3       15
9   10       3       45
10  11       3       65
11  12       3       32
12  13       4       65
13  14       4       12
14  15       4       78
15  16       4       65
16  17       5       98
17  18       5       90
18  19       5       87
19  20       5       58
```

---

#### pandas 함수 조합하기

##### 행, 열 동시 추출하기: `query()`와 `[]` 조합


```python
# nclass가 1인 행만 추출
exam.query('nclass == 1')
```

```
   id  nclass  math  english  science
0   1       1    50       98       50
1   2       1    60       97       60
2   3       1    45       86       78
3   4       1    30       98       58
```

---

#### pandas 함수 조합하기

##### 행, 열 동시 추출하기: `query()`와 `[]` 조합


```python
# nclass가 1인 행만 추출한 다음 english 추출
exam.query('nclass == 1')['english']
```

```
0    98
1    97
2    86
3    98
Name: english, dtype: int64
```

---


##### Q. 2반의 수학 점수 추출

--

```python
exam.query('nclass == 2')['math']
```

```
4    25
5    50
6    80
7    90
Name: math, dtype: int64
```


---

##### Q.  수학 점수가 50점 이상인 학생의 id, math 추출

--


```python
exam.query('math &gt;= 50')[['id', 'math']]
```

```
    id  math
0    1    50
1    2    60
5    6    50
6    7    80
7    8    90
9   10    50
10  11    65
14  15    75
15  16    58
16  17    65
17  18    80
18  19    89
19  20    78
```

---

##### 일부만 출력하기


```python
exam.query('math &gt;= 50')[['id', 'math']].head(10)
```

```
    id  math
0    1    50
1    2    60
5    6    50
6    7    80
7    8    90
9   10    50
10  11    65
14  15    75
15  16    58
16  17    65
```

---


#### 가독성 있게 코드 줄 바꾸기

- [₩]키 입력 

&lt;br-back-20&gt;

.pull-left[

```python
exam.query('math &gt;= 50') \
    [['id', 'math']] \
    .head(10)
```

```
    id  math
0    1    50
1    2    60
5    6    50
6    7    80
7    8    90
9   10    50
10  11    65
14  15    75
15  16    58
16  17    65
```
]

.pull-right[

```python
# math가 50 이상인 행만 추출
# id, math 추출
# 앞부분 10행 추출
```
]

&lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#FF7333;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"&gt;&lt;/path&gt;&lt;/svg&gt;  `\` 뒤에 문자 입력 X

---

### 혼자서 해보기

`mpg` 데이터를 이용해서 분석 문제를 해결해보세요.

Q1. `mpg` 데이터는 11개 변수로 구성되어 있습니다. 이 중 일부만 추출해서 분석에 활용하려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `mpg` 데이터에서 `category`(자동차 종류), `cty`(도시 연비) 변수를 추출해 새로운 데이터를 만드세요. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 새로 만든 데이터의 일부를 출력해서 두 변수로만 구성되어 있는지 확인하세요.

Q2. 자동차 종류에 따라 도시 연비가 다른지 알아보려고 합니다. 앞에서 추출한 데이터를 이용해서 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `category`가 `'suv'`인 자동차와 `'compact'`인 자동차 중 어떤 자동차의 `cty`(도시 연비) &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 평균이 더 높은지 알아보세요.

---

Q1. `mpg` 데이터는 11개 변수로 구성되어 있습니다. 이 중 일부만 추출해서 분석에 활용하려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `mpg` 데이터에서 `category`(자동차 종류), `cty`(도시 연비) 변수를 추출해 새로운 데이터를 만드세요. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 새로 만든 데이터의 일부를 출력해서 두 변수로만 구성되어 있는지 확인하세요.



```python
mpg = pd.read_csv('mpg.csv')        # mpg 데이터 불러오기

mpg_new = mpg[['category', 'cty']]  # category, cty 변수 추출
mpg_new.head()                      # mpg_new 일부 출력
```

```
  category  cty
0  compact   18
1  compact   21
2  compact   20
3  compact   21
4  compact   16
```

---

Q2. 자동차 종류에 따라 도시 연비가 다른지 알아보려고 합니다. 앞에서 추출한 데이터를 이용해서 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `category`가 `'suv'`인 자동차와 `'compact'`인 자동차 중 어떤 자동차의 `cty`(도시 연비) &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 평균이 더 높은지 알아보세요.


```python
mpg_new_suv = mpg_new.query('category == "suv"')          # suv 추출
mpg_new_compact = mpg_new.query('category == "compact"')  # compact 추출
```



```python
mpg_new_suv['cty'].mean()      # suv의 cty 평균
```

```
13.5
```

```python
mpg_new_compact['cty'].mean()  # compact의 cty 평균
```

```
20.127659574468087
```

---

Q2. 자동차 종류에 따라 도시 연비가 다른지 알아보려고 합니다. 앞에서 추출한 데이터를 이용해서 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `category`가 `'suv'`인 자동차와 `'compact'`인 자동차 중 어떤 자동차의 `cty`(도시 연비) &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 평균이 더 높은지 알아보세요.


```python
# 방법2
mpg_new.query('category == "suv"')['cty'].mean()
```

```
13.5
```

```python
mpg_new.query('category == "compact"')['cty'].mean()
```

```
20.127659574468087
```

---

name: arrange
class: title1

순서대로 정렬하기

---
&lt;br&gt;
### .center[순서대로 정렬하기]

&lt;br&gt;

&lt;img src="img/arrange.png" width="600px" style="display: block; margin: auto;" /&gt;


---

#### 오름차순으로 정렬하기


```python
exam.sort_values('math')  # math 오름차순 정렬
```

```
    id  nclass  math  english  science
8    9       3    20       98       15
4    5       2    25       80       65
3    4       1    30       98       58
2    3       1    45       86       78
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
0    1       1    50       98       50
9   10       3    50       98       45
5    6       2    50       89       98
15  16       4    58       98       65
1    2       1    60       97       60
10  11       3    65       65       65
16  17       5    65       68       98
14  15       4    75       56       78
19  20       5    78       83       58
6    7       2    80       90       45
17  18       5    80       78       90
18  19       5    89       68       87
7    8       2    90       78       25
```

---

#### 내림차순으로 정렬하기


```python
exam.sort_values('math', ascending = False)    # math 내림차순 정렬
```

```
    id  nclass  math  english  science
7    8       2    90       78       25
18  19       5    89       68       87
17  18       5    80       78       90
6    7       2    80       90       45
19  20       5    78       83       58
14  15       4    75       56       78
16  17       5    65       68       98
10  11       3    65       65       65
1    2       1    60       97       60
15  16       4    58       98       65
9   10       3    50       98       45
5    6       2    50       89       98
0    1       1    50       98       50
13  14       4    48       87       12
12  13       4    46       98       65
11  12       3    45       85       32
2    3       1    45       86       78
3    4       1    30       98       58
4    5       2    25       80       65
8    9       3    20       98       15
```

---

#### 여러 기준으로 정렬하기


```python
exam.sort_values(['nclass', 'math'])  # nclass 및 math 오름차순 정렬
```

```
    id  nclass  math  english  science
3    4       1    30       98       58
2    3       1    45       86       78
0    1       1    50       98       50
1    2       1    60       97       60
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
11  12       3    45       85       32
9   10       3    50       98       45
10  11       3    65       65       65
12  13       4    46       98       65
13  14       4    48       87       12
15  16       4    58       98       65
14  15       4    75       56       78
16  17       5    65       68       98
19  20       5    78       83       58
17  18       5    80       78       90
18  19       5    89       68       87
```

---

#### 여러 기준으로 정렬하기 - 정렬 순서 따로 정하기


```python
exam.sort_values(['nclass', 'math'], ascending = [True, False])
```

```
    id  nclass  math  english  science
1    2       1    60       97       60
0    1       1    50       98       50
2    3       1    45       86       78
3    4       1    30       98       58
7    8       2    90       78       25
6    7       2    80       90       45
5    6       2    50       89       98
4    5       2    25       80       65
10  11       3    65       65       65
9   10       3    50       98       45
11  12       3    45       85       32
8    9       3    20       98       15
14  15       4    75       56       78
15  16       4    58       98       65
13  14       4    48       87       12
12  13       4    46       98       65
18  19       5    89       68       87
17  18       5    80       78       90
19  20       5    78       83       58
16  17       5    65       68       98
```


---


### 혼자서 해보기

`mpg` 데이터를 이용해서 분석 문제를 해결해보세요.

Q. `'audi'`에서 생산한 자동차 중에 어떤 자동차 모델의 `hwy`(고속도로 연비)가 높은지 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `'audi'`에서 생산한 자동차 중 `hwy`가 1~5위에 해당하는 자동차의 데이터 출력하세요.


---

Q. `'audi'`에서 생산한 자동차 중에 어떤 자동차 모델의 `hwy`(고속도로 연비)가 높은지 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `'audi'`에서 생산한 자동차 중 `hwy`가 1~5위에 해당하는 자동차의 데이터 출력하세요.



```python
mpg = pd.read_csv('mpg.csv')
```

&lt;br-back-20&gt;

.pull-left-60[


```python
mpg.query('manufacturer == "audi"') \
   .sort_values('hwy', ascending = False) \
   .head()
```
]

.pull-right-40[

```python
# audi 추출
# hwy 내림차순 정렬
# 5행까지 출력
```

]


```
  manufacturer       model  displ  year  cyl  ... drv cty  hwy  fl category
2         audi          a4    2.0  2008    4  ...   f  20   31   p  compact
3         audi          a4    2.0  2008    4  ...   f  21   30   p  compact
0         audi          a4    1.8  1999    4  ...   f  18   29   p  compact
1         audi          a4    1.8  1999    4  ...   f  21   29   p  compact
9         audi  a4 quattro    2.0  2008    4  ...   4  20   28   p  compact

[5 rows x 11 columns]
```


---

name: assign
class: title1

파생변수 추가하기

---

&lt;br&gt;
### .center[파생변수 추가하기]

&lt;br&gt;

&lt;img src="img/assign.png" width="600px" style="display: block; margin: auto;" /&gt;

---

### 파생변수 추가하기


```python
# total 변수 추가
exam.assign(total = exam['math'] + exam['english'] + exam['science'])
```

```
    id  nclass  math  english  science  total
0    1       1    50       98       50    198
1    2       1    60       97       60    217
2    3       1    45       86       78    209
3    4       1    30       98       58    186
4    5       2    25       80       65    170
5    6       2    50       89       98    237
6    7       2    80       90       45    215
7    8       2    90       78       25    193
8    9       3    20       98       15    133
9   10       3    50       98       45    193
10  11       3    65       65       65    195
11  12       3    45       85       32    162
12  13       4    46       98       65    209
13  14       4    48       87       12    147
14  15       4    75       56       78    209
15  16       4    58       98       65    221
16  17       5    65       68       98    231
17  18       5    80       78       90    248
18  19       5    89       68       87    244
19  20       5    78       83       58    219
```

---

#### 여러 파생변수 한 번에 추가하기


```python
exam.assign(
  total = exam['math'] + exam['english'] + exam['science'],       # total 추가
  mean = (exam['math'] + exam['english'] + exam['science']) / 3)  # mean 추가
```

```
    id  nclass  math  english  science  total       mean
0    1       1    50       98       50    198  66.000000
1    2       1    60       97       60    217  72.333333
2    3       1    45       86       78    209  69.666667
3    4       1    30       98       58    186  62.000000
4    5       2    25       80       65    170  56.666667
5    6       2    50       89       98    237  79.000000
6    7       2    80       90       45    215  71.666667
7    8       2    90       78       25    193  64.333333
8    9       3    20       98       15    133  44.333333
9   10       3    50       98       45    193  64.333333
10  11       3    65       65       65    195  65.000000
11  12       3    45       85       32    162  54.000000
12  13       4    46       98       65    209  69.666667
13  14       4    48       87       12    147  49.000000
14  15       4    75       56       78    209  69.666667
15  16       4    58       98       65    221  73.666667
16  17       5    65       68       98    231  77.000000
17  18       5    80       78       90    248  82.666667
18  19       5    89       68       87    244  81.333333
19  20       5    78       83       58    219  73.000000
```


---


#### `df.assign()`에 `np.where()` 적용하기


```python
import numpy as np
exam.assign(test = np.where(exam['science'] &gt;= 60, 'pass', 'fall'))
```

```
    id  nclass  math  english  science  test
0    1       1    50       98       50  fall
1    2       1    60       97       60  pass
2    3       1    45       86       78  pass
3    4       1    30       98       58  fall
4    5       2    25       80       65  pass
5    6       2    50       89       98  pass
6    7       2    80       90       45  fall
7    8       2    90       78       25  fall
8    9       3    20       98       15  fall
9   10       3    50       98       45  fall
10  11       3    65       65       65  pass
11  12       3    45       85       32  fall
12  13       4    46       98       65  pass
13  14       4    48       87       12  fall
14  15       4    75       56       78  pass
15  16       4    58       98       65  pass
16  17       5    65       68       98  pass
17  18       5    80       78       90  pass
18  19       5    89       68       87  pass
19  20       5    78       83       58  fall
```

---

#### 추가한 변수 활용하기

&lt;br-back-20&gt;

.left[

```python
exam.assign(total = exam['math'] + exam['english'] + exam['science']) \
    .sort_values('total')
```

```
    id  nclass  math  english  science  total
8    9       3    20       98       15    133
13  14       4    48       87       12    147
11  12       3    45       85       32    162
4    5       2    25       80       65    170
3    4       1    30       98       58    186
9   10       3    50       98       45    193
7    8       2    90       78       25    193
10  11       3    65       65       65    195
0    1       1    50       98       50    198
2    3       1    45       86       78    209
12  13       4    46       98       65    209
14  15       4    75       56       78    209
6    7       2    80       90       45    215
1    2       1    60       97       60    217
19  20       5    78       83       58    219
15  16       4    58       98       65    221
16  17       5    65       68       98    231
5    6       2    50       89       98    237
18  19       5    89       68       87    244
17  18       5    80       78       90    248
```
]

.pull-right[


```python
# total 변수 추가
# total 기준 정렬
```
]

---



#### `lambda` 이용해 데이터 프레임명 줄여 쓰기


```python
# df명 직접 입력
exam.assign(total = exam['math'] + exam['english'] + exam['science'])
```

```
    id  nclass  math  english  science  total
0    1       1    50       98       50    198
1    2       1    60       97       60    217
2    3       1    45       86       78    209
3    4       1    30       98       58    186
4    5       2    25       80       65    170
5    6       2    50       89       98    237
6    7       2    80       90       45    215
7    8       2    90       78       25    193
8    9       3    20       98       15    133
9   10       3    50       98       45    193
10  11       3    65       65       65    195
11  12       3    45       85       32    162
12  13       4    46       98       65    209
13  14       4    48       87       12    147
14  15       4    75       56       78    209
15  16       4    58       98       65    221
16  17       5    65       68       98    231
17  18       5    80       78       90    248
18  19       5    89       68       87    244
19  20       5    78       83       58    219
```

---


#### `lambda` 이용해 데이터 프레임명 줄여 쓰기


```python
# df명 대신 x 입력
exam.assign(total = lambda x: x['math'] + x['english'] + x['science'])
```

```
    id  nclass  math  english  science  total
0    1       1    50       98       50    198
1    2       1    60       97       60    217
2    3       1    45       86       78    209
3    4       1    30       98       58    186
4    5       2    25       80       65    170
5    6       2    50       89       98    237
6    7       2    80       90       45    215
7    8       2    90       78       25    193
8    9       3    20       98       15    133
9   10       3    50       98       45    193
10  11       3    65       65       65    195
11  12       3    45       85       32    162
12  13       4    46       98       65    209
13  14       4    48       87       12    147
14  15       4    75       56       78    209
15  16       4    58       98       65    221
16  17       5    65       68       98    231
17  18       5    80       78       90    248
18  19       5    89       68       87    244
19  20       5    78       83       58    219
```

---

#### `lambda` 이용해 데이터 프레임명 줄여 쓰기

- 앞에서 추가한 변수 활용할 때 필수


```python
exam.assign(total = exam['math'] + exam['english'] + exam['science'],
            mean  = exam['total'] / 3)
```


```
KeyError: 'total'
```


---

#### `lambda` 이용해 데이터 프레임명 줄여 쓰기

- 앞에서 추가한 변수 활용할 때 필수


```python
exam.assign(total = exam['math'] + exam['english'] + exam['science'],
            mean  = lambda x: x['total'] / 3)    
```

```
    id  nclass  math  english  science  total       mean
0    1       1    50       98       50    198  66.000000
1    2       1    60       97       60    217  72.333333
2    3       1    45       86       78    209  69.666667
3    4       1    30       98       58    186  62.000000
4    5       2    25       80       65    170  56.666667
5    6       2    50       89       98    237  79.000000
6    7       2    80       90       45    215  71.666667
7    8       2    90       78       25    193  64.333333
8    9       3    20       98       15    133  44.333333
9   10       3    50       98       45    193  64.333333
10  11       3    65       65       65    195  65.000000
11  12       3    45       85       32    162  54.000000
12  13       4    46       98       65    209  69.666667
13  14       4    48       87       12    147  49.000000
14  15       4    75       56       78    209  69.666667
15  16       4    58       98       65    221  73.666667
16  17       5    65       68       98    231  77.000000
17  18       5    80       78       90    248  82.666667
18  19       5    89       68       87    244  81.333333
19  20       5    78       83       58    219  73.000000
```

---

#### `lambda` 이용해 데이터 프레임명 줄여 쓰기

- 앞에서 추가한 변수 활용할 때 필수


```python
exam.assign(total = lambda x: x['math'] + x['english'] + x['science'],
            mean  = lambda x: x['total'] / 3)    
```

```
    id  nclass  math  english  science  total       mean
0    1       1    50       98       50    198  66.000000
1    2       1    60       97       60    217  72.333333
2    3       1    45       86       78    209  69.666667
3    4       1    30       98       58    186  62.000000
4    5       2    25       80       65    170  56.666667
5    6       2    50       89       98    237  79.000000
6    7       2    80       90       45    215  71.666667
7    8       2    90       78       25    193  64.333333
8    9       3    20       98       15    133  44.333333
9   10       3    50       98       45    193  64.333333
10  11       3    65       65       65    195  65.000000
11  12       3    45       85       32    162  54.000000
12  13       4    46       98       65    209  69.666667
13  14       4    48       87       12    147  49.000000
14  15       4    75       56       78    209  69.666667
15  16       4    58       98       65    221  73.666667
16  17       5    65       68       98    231  77.000000
17  18       5    80       78       90    248  82.666667
18  19       5    89       68       87    244  81.333333
19  20       5    78       83       58    219  73.000000
```


---

### 혼자서 해보기


`mpg` 데이터를 이용해서 분석 문제를 해결해보세요.

`mpg` 데이터는 연비를 나타내는 변수가 `hwy`(고속도로 연비), `cty`(도시 연비) 두 종류로 분리되어 있습니다. 두 변수를 각각 활용하는 대신 하나의 합산 연비 변수를 만들어 분석하려고 합니다.

Q1. `mpg` 데이터 복사본을 만들고, `cty`와 `hwy`를 더한 '합산 연비 변수'를 추가하세요.

Q2. 앞에서 만든 '합산 연비 변수'를 2로 나눠 '평균 연비 변수'를 추가하세요.

Q3. '평균 연비 변수'가 가장 높은 자동차 3종의 데이터를 출력하세요.

Q4. 1~3번 문제를 해결할 수 있는 하나로 연결된 `pandas` 구문을 만들어 실행해 보세요. &lt;br&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;데이터는 복사본 대신 `mpg` 원본을 이용하세요.

---

Q1. `mpg` 데이터 복사본을 만들고, `cty`와 `hwy`를 더한 '합산 연비 변수'를 추가하세요.


```python
mpg = pd.read_csv('mpg.csv')                               # mpg 데이터 불러오기
mpg_new = mpg.copy()                                       # mpg 복사본 만들기
mpg_new = mpg_new.assign(total = mpg['cty'] + mpg['hwy'])  # 합산 연비 변수 추가
```

---

Q2. 앞에서 만든 '합산 연비 변수'를 2로 나눠 '평균 연비 변수'를 추가하세요.


```python
mpg_new = mpg_new.assign(mean = mpg_new['total'] / 2)  # 평균 연비 변수 추가
```

---

Q3. '평균 연비 변수'가 가장 높은 자동차 3종의 데이터를 출력하세요.


```python
# mean 기준 내림차순 정렬, 상위 3행 출력
mpg_new.sort_values('mean', ascending = False).head(3)  
```


```
    manufacturer       model  displ  year  ... fl    category  total  mean
221   volkswagen  new beetle    1.9  1999  ...  d  subcompact     79  39.5
212   volkswagen       jetta    1.9  1999  ...  d     compact     77  38.5
222   volkswagen  new beetle    1.9  1999  ...  d  subcompact     70  35.0

[3 rows x 12 columns]
```

---

Q4. 1~3번 문제를 해결할 수 있는 하나로 연결된 `pandas` 구문을 만들어 실행해 보세요. &lt;br&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;데이터는 복사본 대신 `mpg` 원본을 이용하세요.

&lt;br-back-20&gt;

.pull-left-70[

```python
mpg.assign(total = lambda x: x['cty'] + x['hwy'],
           mean  = lambda x: x['total'] / 2) \
   .sort_values('mean', ascending = False) \
   .head(3)
```
]

.pull-right-30[


```python
# 합산 연비 변수 추가
# 평균 연비 변수 추가
# 내림차순 정렬
# 상위 3행 출력
```
]


```
    manufacturer       model  displ  year  ... fl    category  total  mean
221   volkswagen  new beetle    1.9  1999  ...  d  subcompact     79  39.5
212   volkswagen       jetta    1.9  1999  ...  d     compact     77  38.5
222   volkswagen  new beetle    1.9  1999  ...  d  subcompact     70  35.0

[3 rows x 12 columns]
```





---


name: groupby_summarise
class: title1

집단별로 요약하기

---
&lt;br&gt;
### .center[집단별로 요약하기]

&lt;br&gt;

&lt;img src="img/groupby_summarise.png" width="600px" style="display: block; margin: auto;" /&gt;

---

#### 요약 통계량 구하기



```python
exam.agg(mean_math = ('math', 'mean'))  # math 평균 산출
```

```
            math
mean_math  57.45
```

--

&lt;br&gt;

#### 집단별 요약 통계량 구하기

&lt;br-back-20&gt;

.pull-left-50[

```python
exam.groupby('nclass') \
    .agg(mean_math = ('math', 'mean'))
```

```
        mean_math
nclass           
1           46.25
2           61.25
3           45.00
4           56.75
5           78.00
```
]

.pull-right-50[

```python
# nclass별로 분리
# math 평균 산출
```

]


---

#### 여러 요약 통계량 한 번에 구하기

.pull-left-60[

```python
exam.groupby('nclass') \
    .agg(mean_math   = ('math', 'mean'),    
         sum_math    = ('math', 'sum'),     
         median_math = ('math', 'median'),          
         n           = ('nclass', 'count')) 
```

```
        mean_math  sum_math  median_math  n
nclass                                     
1           46.25       185         47.5  4
2           61.25       245         65.0  4
3           45.00       180         47.5  4
4           56.75       227         53.0  4
5           78.00       312         79.0  4
```
]

.pull-right-40[

```python
# nclass별로 분리
# 수학 점수 평균 
# 수학 점수 합계 
# 수학 점수 중앙값   
# 빈도(학생 수) 
```

]

---

#### 변수를 인덱스로 바꾸지 않기: `as_index = False`


```python
exam.groupby('nclass') \
    .agg(mean_math = ('math', 'mean'))
```

```
        mean_math
nclass           
1           46.25
2           61.25
3           45.00
4           56.75
5           78.00
```

---

#### 변수를 인덱스로 바꾸지 않기: `as_index = False`


```python
exam.groupby('nclass', as_index = False) \
    .agg(mean_math = ('math', 'mean'))
```

```
   nclass  mean_math
0       1      46.25
1       2      61.25
2       3      45.00
3       4      56.75
4       5      78.00
```

---

#### 자주 사용하는 요약 통계량 함수

.left[
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;함수    |&amp;nbsp; &amp;nbsp; &amp;nbsp; 의미
--------|-----
&amp;nbsp; &amp;nbsp; mean()  &amp;nbsp;|&amp;nbsp; &amp;nbsp; 평균&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp; &amp;nbsp; std()   &amp;nbsp;|&amp;nbsp; &amp;nbsp; 표준편차&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp; &amp;nbsp; sum()   &amp;nbsp;|&amp;nbsp; &amp;nbsp; 합계&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp; &amp;nbsp; median()&amp;nbsp;|&amp;nbsp; &amp;nbsp; 중앙값&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp; &amp;nbsp; min()   &amp;nbsp;|&amp;nbsp; &amp;nbsp; 최솟값&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp; &amp;nbsp; max()   &amp;nbsp;|&amp;nbsp; &amp;nbsp; 최댓값&amp;nbsp;&amp;nbsp;&amp;nbsp;
&amp;nbsp; &amp;nbsp; count() &amp;nbsp;|&amp;nbsp; &amp;nbsp; 빈도(개수)&amp;nbsp;&amp;nbsp;&amp;nbsp;
]
---

#### 모든 변수의 요약 통계량 한 번에 구하기


```python
exam.groupby('nclass').mean()
```

```
          id   math  english  science
nclass                               
1        2.5  46.25    94.75    61.50
2        6.5  61.25    84.25    58.25
3       10.5  45.00    86.50    39.25
4       14.5  56.75    84.75    55.00
5       18.5  78.00    74.25    83.25
```

- `df.agg()`: 여러 종류의 요약 통계량 구하기
- `df.mean()`: 한 가지 요약 통계량 구하기

 
---


#### 하위 집단별로 다시 나누기




.pull-left-50[

```python
mpg.groupby(['manufacturer', 'drv']) \
   .agg(mean_cty = ('cty', 'mean'))
```

```
                   mean_cty
manufacturer drv           
audi         4    16.818182
             f    18.857143
chevrolet    4    12.500000
             f    18.800000
             r    14.100000
dodge        4    12.000000
             f    15.818182
ford         4    13.307692
             r    14.750000
honda        f    24.444444
hyundai      f    18.642857
jeep         4    13.500000
land rover   4    11.500000
lincoln      r    11.333333
mercury      4    13.250000
nissan       4    13.750000
             f    20.000000
pontiac      f    17.000000
subaru       4    19.285714
toyota       4    14.933333
             f    21.368421
volkswagen   f    20.925926
```
]

.pull-right-50[

```python
# 회사 및 구동 방식별 분리
# cty 평균 구하기
```
]


---

#### `value_counts()`로 집단별 빈도 간단하게 구하기


```python
mpg.groupby('drv') \
   .agg(n = ('drv', 'count'))
```

```
       n
drv     
4    103
f    106
r     25
```

--

```python
mpg['drv'].value_counts()
```

```
drv
f    106
4    103
r     25
Name: count, dtype: int64
```

---

#### `value_counts()`로 집단별 빈도 간단하게 구하기

- 시리즈 자료 구조에 `query()` 적용 불가


```python
mpg['drv'].value_counts().query('n &gt; 100')
mpg['drv'].value_counts().query('drv == "r"')
```

&lt;br&gt;

- 데이터 프레임으로 변환 후 적용


```python
mpg['drv'].value_counts()\
          .to_frame('n')\
          .query('n &gt; 100')
```


---


### 혼자서 해보기

`mpg` 데이터를 이용해서 분석 문제를 해결해 보세요.

Q1. `mpg` 데이터의 `category`는 자동차를 특징에 따라 `'suv'`, `'compact'` 등 일곱 종류로 분류한 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 변수입니다. 어떤 차종의 연비가 높은지 비교해보려고 합니다. `category`별 `cty` 평균을 구해보세요.

Q2. 앞 문제의 출력 결과는 `category` 값 알파벳 순으로 정렬되어 있습니다. 어떤 차종의 도시 연비가 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 높은지 쉽게 알아볼 수 있도록 `cty` 평균이 높은 순으로 정렬하여 출력하세요.

Q3. 어떤 회사 자동차의 `hwy`(고속도로 연비)가 가장 높은지 알아보려고 합니다. `hwy` 평균이 가장 높은 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 회사 세 곳을 출력하세요.

Q4. 어떤 회사에서 `'compact'` 차종을 가장 많이 생산하는지 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 각 회사별 `'compact'` 차종 수를 내림차순으로 정렬해 출력하세요.

---

Q1. `mpg` 데이터의 `category`는 자동차를 특징에 따라 `'suv'`, `'compact'` 등 일곱 종류로 분류한 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 변수입니다. 어떤 차종의 연비가 높은지 비교해보려고 합니다. `category`별 `cty` 평균을 구해보세요.

```python
mpg = pd.read_csv('mpg.csv')
```

&lt;br-back-20&gt;

.pull-left[

```python
mpg.groupby('category') \
   .agg(mean_cty = ('cty', 'mean'))
```

```
             mean_cty
category             
2seater     15.400000
compact     20.127660
midsize     18.756098
minivan     15.818182
pickup      13.000000
subcompact  20.371429
suv         13.500000
```
]

.pull-right[

```python
# category별 분리
# cty 평균 구하기
```
]

---

Q2. 앞 문제의 출력 결과는 `category` 값 알파벳 순으로 정렬되어 있습니다. 어떤 차종의 도시 연비가 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 높은지 쉽게 알아볼 수 있도록 `cty` 평균이 높은 순으로 정렬하여 출력하세요.

.pull-left-60[

```python
mpg.groupby('category') \
   .agg(mean_cty = ('cty', 'mean')) \
   .sort_values('mean_cty', ascending = False)
```

```
             mean_cty
category             
subcompact  20.371429
compact     20.127660
midsize     18.756098
minivan     15.818182
2seater     15.400000
suv         13.500000
pickup      13.000000
```

]

.pull-right-40[

```python
# category별 분리
# cty 평균 구하기
# 내림차순 정렬하기
```
]


---

Q3. 어떤 회사 자동차의 `hwy`(고속도로 연비)가 가장 높은지 알아보려고 합니다. `hwy` 평균이 가장 높은 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 회사 세 곳을 출력하세요.


.pull-left-60[

```python
mpg.groupby('manufacturer') \
   .agg(mean_hwy = ('hwy', 'mean')) \
   .sort_values('mean_hwy', ascending = False)\
   .head(3)
```

```
               mean_hwy
manufacturer           
honda         32.555556
volkswagen    29.222222
hyundai       26.857143
```

]
.pull-right-40[

```python
# manufacturer별 분리
# hwy 평균 구하기
# 내림차순 정렬하기
# 상위 3행 추출
```
]

---

Q4. 어떤 회사에서 `'compact'` 차종을 가장 많이 생산하는지 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 각 회사별 `'compact'` 차종 수를 내림차순으로 정렬해 출력하세요.

.pull-left-60[

```python
mpg.query('category == "compact"') \
   .groupby('manufacturer') \
   .agg(n = ('manufacturer', 'count')) \
   .sort_values('n', ascending = False)
```

```
               n
manufacturer    
audi          15
volkswagen    14
toyota        12
subaru         4
nissan         2
```

]
.pull-right-40[


```python
# compact 추출
# manufacturer별 분리
# 빈도 구하기
# 내림차순 정렬
```
]

---
Q4. 어떤 회사에서 `'compact'` 차종을 가장 많이 생산하는지 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 각 회사별 `'compact'` 차종 수를 내림차순으로 정렬해 출력하세요.


- 방법2

&lt;br-back-20&gt;

.pull-left[

```python
mpg.query('category == "compact"') \
   .value_counts('manufacturer')
```

]
.pull-right[


```python
# compact 추출
# manufacturer별 빈도 구하기
```
]


```
manufacturer
audi          15
volkswagen    14
toyota        12
subaru         4
nissan         2
Name: count, dtype: int64
```


---

class:title1

분석 도전

---

### 분석 도전

`midwest` 데이터는 미국 동북중부 437개 지역의 인구통계 정보를 담고 있습니다. `midwest.csv`를 &lt;br&gt;이용해서 데이터 분석 문제를 해결해보세요.

Q1. `popadults`는 해당 지역의 성인 인구, `poptotal`은 전체 인구를 나타냅니다. `midwest` 데이터에 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; '전체 인구 대비 미성년 인구 백분율' 변수를 추가하세요.

Q2. 미성년 인구 백분율이 가장 높은 상위 5개 `county`(지역)의 미성년 인구 백분율을 출력하세요.

Q3. 분류표의 기준에 따라 미성년 비율 등급 변수를 추가하고, 각 등급에 몇 개의 지역이 있는지 알아보세요.

분류  |기준
:------:|:----:
&amp;nbsp; &amp;nbsp; &amp;nbsp; large &amp;nbsp; &amp;nbsp; &amp;nbsp; | 40% 이상
&amp;nbsp; &amp;nbsp; &amp;nbsp; middle &amp;nbsp; &amp;nbsp; &amp;nbsp;| 30% ~ 40% 미만
&amp;nbsp;&amp;nbsp; &amp;nbsp;  small &amp;nbsp; &amp;nbsp; &amp;nbsp; | 30% 미만

Q4. `popasian`은 해당 지역의 아시아인 인구를 나타냅니다. '전체 인구 대비 아시아인 인구 백분율' 변수를 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 추가하고, 하위 10개 지역의 `state`(주), `county`(지역명), 아시아인 인구 백분율을 출력하세요.


---

Q1. `popadults`는 해당 지역의 성인 인구, `poptotal`은 전체 인구를 나타냅니다. `midwest` 데이터에 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; '전체 인구 대비 미성년 인구 백분율' 변수를 추가하세요.

```python
# midwest 불러오기
midwest = pd.read_csv('midwest.csv')

# midwest에 백분율 변수 추가
midwest['ratio'] = (midwest['poptotal'] - midwest['popadults']) \
                  / midwest['poptotal'] * 100
```


--


```python
# 방법2
midwest['ratio'] = (1 - midwest['popadults'] / midwest['poptotal']) * 100
```

---
Q2. 미성년 인구 백분율이 가장 높은 상위 5개 `county`(지역)의 미성년 인구 백분율을 출력하세요.

.pull-left-60[


```python
midwest.sort_values('ratio', ascending=False) \
       .head() \
       [['county', 'ratio']]
```

```
        county      ratio
230   ISABELLA  51.501172
404  MENOMINEE  50.591260
281     ATHENS  49.320727
247    MECOSTA  49.059183
154     MONROE  47.358182
```
]
.pull-right-40[

```python
# ratio 내림차순 정렬
# 상위 5행 추출
# 변수 추출
```
]

---
Q3. 분류표의 기준에 따라 미성년 비율 등급 변수를 추가하고, 각 등급에 몇 개의 지역이 있는지 알아보세요.


분류  |기준
:------:|:----:
&amp;nbsp; &amp;nbsp; &amp;nbsp; large &amp;nbsp; &amp;nbsp; &amp;nbsp; | 40% 이상
&amp;nbsp; &amp;nbsp; &amp;nbsp; middle &amp;nbsp; &amp;nbsp; &amp;nbsp;| 30% ~ 40% 미만
&amp;nbsp;&amp;nbsp; &amp;nbsp;  small &amp;nbsp; &amp;nbsp; &amp;nbsp; | 30% 미만



```python
# 등급 변수 추가
midwest['grade'] = np.where(midwest['ratio'] &gt;= 40, 'large',
                   np.where(midwest['ratio'] &gt;= 30, 'middle', 'small'))
```

&lt;br-back-20&gt;

.pull-left-60[


```python
midwest.groupby('grade') \
       .agg(n = ('grade', 'count'))
```

```
          n
grade      
large    32
middle  396
small     9
```
]

.pull-right-40[

```python
# grade별 분리
# grade 빈도 구하기
```
]

---
Q3. 분류표의 기준에 따라 미성년 비율 등급 변수를 추가하고, 각 등급에 몇 개의 지역이 있는지 알아보세요.


분류  |기준
:------:|:----:
&amp;nbsp; &amp;nbsp; &amp;nbsp; large &amp;nbsp; &amp;nbsp; &amp;nbsp; | 40% 이상
&amp;nbsp; &amp;nbsp; &amp;nbsp; middle &amp;nbsp; &amp;nbsp; &amp;nbsp;| 30% ~ 40% 미만
&amp;nbsp;&amp;nbsp; &amp;nbsp;  small &amp;nbsp; &amp;nbsp; &amp;nbsp; | 30% 미만



```python
# 등급 변수 추가
midwest['grade'] = np.where(midwest['ratio'] &gt;= 40, 'large',
                   np.where(midwest['ratio'] &gt;= 30, 'middle', 'small'))
```


```python
# 방법2
midwest['grade'].value_counts()
```

```
grade
middle    396
large      32
small       9
Name: count, dtype: int64
```


---

&lt;br-back-10&gt;

Q4. `popasian`은 해당 지역의 아시아인 인구를 나타냅니다. '전체 인구 대비 아시아인 인구 백분율' 변수를 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 추가하고, 하위 10개 지역의 `state`(주), `county`(지역명), 아시아인 인구 백분율을 출력하세요.

&lt;br-back-10&gt;


```python
midwest.assign(ratio_asian = midwest['popasian'] / midwest['poptotal'] * 100) \
       .sort_values('ratio_asian') \
       .head(10) \
       [['state', 'county', 'ratio_asian']]
```



```python
# 백분율 변수 추가
# 내림차순 정렬
# 상위 10행 출력
# 변수 추출
```


```
    state     county  ratio_asian
404    WI  MENOMINEE     0.000000
105    IN     BENTON     0.010592
109    IN    CARROLL     0.015950
358    OH     VINTON     0.027032
390    WI       IRON     0.032504
85     IL      SCOTT     0.053154
112    IN       CLAY     0.060716
261    MI     OSCODA     0.063759
340    OH      PERRY     0.066546
73     IL      PIATT     0.070749
```




---

class: title0

쉽게 배우는 Python 데이터 분석 Part 3

---

name: graph
class: title0

&lt;5&gt; 그래프 만들기

---
&lt;br10&gt;
### .center[그래프 만들기]

&lt;br&gt;
&lt;img src="img/plots.png" width="600px" style="display: block; margin: auto;" /&gt;

---
&lt;br&gt;

.left[
#### 다양한 그래프
- 2차원 그래프, 3차원 그래프
- 지도 그래프
- 네트워크 그래프
- 모션 차트
- 인터랙티브 그래프
]

.right[
&lt;img src="img/graphs.png" width="500px" style="display: block; margin: auto;" /&gt;
]

---

name: point
class: title1

산점도

---

#### 산점도

- 산점도(Scater Plot) : 데이터를 x축과 y축에 점으로 표현한 그래프
- 나이와 소득처럼, 연속 값으로 된 두 변수의 관계를 표현할 때 사용

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-292-1.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-292-2.png" width="50%" /&gt;

---

#### 준비하기

```python
import seaborn as sns
mpg = pd.read_csv('mpg.csv')
```

---


#### 1. 산점도 만들기


```python
sns.scatterplot(data = mpg, x = 'displ', y = 'hwy')
```

&lt;br-back-20&gt;


&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-295-5.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-295-6.png" width="50%" /&gt;


---

#### 2. 설정 추가하기 - x축 고정

```python
sns.scatterplot(data = mpg, x = 'displ', y = 'hwy') \
   .set(xlim = [3, 6])
```

&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-297-9.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-297-10.png" width="50%" /&gt;
---

#### 3. 설정 추가하기 - x축, y축 고정


```python
sns.scatterplot(data = mpg, x = 'displ', y = 'hwy') \
   .set(xlim = [3, 6], ylim = [10, 30])
```

&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-299-13.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-299-14.png" width="50%" /&gt;

---

#### 4. 종류별로 표식 색 바꾸기


```python
sns.scatterplot(data = mpg, x = 'displ', y = 'hwy', hue = 'drv')
```

&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-301-17.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-301-18.png" width="50%" /&gt;



---


### 혼자서 해보기

**`mpg` 데이터와 `midwest` 데이터를 이용해서 분석 문제를 해결해 보세요.**

Q1. `mpg` 데이터의 `cty`(도시 연비)와 `hwy`(고속도로 연비) 간에 어떤 관계가 있는지 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; x축은 `cty`, y축은 `hwy`로 된 산점도를 만들어 보세요.

Q2. 미국 지역별 인구통계 정보를 담은 `midwest.csv`를 이용해서 전체 인구와 아시아인 인구 간에 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;어떤 관계가 있는지 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; •x축은 `poptotal`(전체 인구), y축은 `popasian`(아시아인 인구)으로 된 산점도를 만들어 보세요. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; •전체 인구는 50만 명 이하, 아시아인 인구는 1만 명 이하인 지역만 산점도에 표시되게 설정하세요.

---


Q1. `mpg` 데이터의 `cty`(도시 연비)와 `hwy`(고속도로 연비) 간에 어떤 관계가 있는지 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; x축은 `cty`, y축은 `hwy`로 된 산점도를 만들어 보세요.

```python
sns.scatterplot(data = mpg, x = 'cty', y = 'hwy')
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-303-21.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-303-22.png" width="50%" /&gt;



---

Q2. 미국 지역별 인구통계 정보를 담은 `midwest.csv`를 이용해서 전체 인구와 아시아인 인구 간에 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;어떤 관계가 있는지 알아보려고 합니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; •x축은 `poptotal`(전체 인구), y축은 `popasian`(아시아인 인구)으로 된 산점도를 만들어 보세요. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; •전체 인구는 50만 명 이하, 아시아인 인구는 1만 명 이하인 지역만 산점도에 표시되게 설정하세요.




```python
sns.scatterplot(data = midwest, x = 'poptotal', y = 'popasian') \
   .set(xlim = [0, 500000], ylim = [0, 10000])
```

&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-306-25.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-306-26.png" width="50%" /&gt;

---

name: bar
class: title1

막대 그래프

---

#### 막대 그래프

- 막대 그래프(Bar Chart) : 데이터의 크기를 막대의 길이로 표현한 그래프
- 성별 소득 차이처럼 집단 간 차이를 표현할 때 주로 사용

&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-307-29.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-307-30.png" width="50%" /&gt;

---

#### 1. 집단별 요약표 만들기

```python
df_mpg = mpg.groupby('drv') \
            .agg(mean_hwy = ('hwy', 'mean'))
df_mpg
```

```
      mean_hwy
drv           
4    19.174757
f    28.160377
r    21.000000
```

--

##### 변수 유지


```python
df_mpg = mpg.groupby('drv', as_index = False) \
            .agg(mean_hwy = ('hwy', 'mean'))
df_mpg
```

```
  drv   mean_hwy
0   4  19.174757
1   f  28.160377
2   r  21.000000
```

---

#### 2. 그래프 만들기


```python
sns.barplot(data = df_mpg, x = 'drv', y = 'mean_hwy')
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-311-33.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-311-34.png" width="50%" /&gt;


---

#### 2. 그래프 만들기 - 내림차순 정렬

```python
# 데이터 프레임 정렬하기
df_mpg = df_mpg.sort_values('mean_hwy', ascending = False)

# 막대 그래프 만들기
sns.barplot(data = df_mpg, x = 'drv', y = 'mean_hwy')
```


&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-313-37.png" width="58%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-313-38.png" width="58%" /&gt;


---

### 혼자서 해보기

`mpg` 데이터를 이용해서 분석 문제를 해결해 보세요.

Q. 어떤 회사에서 생산한 `'suv'` 차종의 도시 연비가 높은지 알아보려고 합니다. `'suv'` 차종을 대상으로 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `cty`(도시 연비) 평균이 가장 높은 회사 다섯 곳을 막대 그래프로 표현해 보세요. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; •막대는 연비가 높은 순으로 정렬하세요.

---

Q. 어떤 회사에서 생산한 `'suv'` 차종의 도시 연비가 높은지 알아보려고 합니다. `'suv'` 차종을 대상으로 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `cty`(도시 연비) 평균이 가장 높은 회사 다섯 곳을 막대 그래프로 표현해 보세요. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; •막대는 연비가 높은 순으로 정렬하세요.


- 평균표 만들기


&lt;br-back-20&gt;

.pull-left-70[


```python
# mpg 데이터 불러오기
mpg = pd.read_csv('mpg.csv')

df = mpg.query('category == "suv"') \
        .groupby('manufacturer', as_index = False) \
        .agg(mean_cty = ('cty', 'mean')) \
        .sort_values('mean_cty', ascending = False) \
        .head()
```
]

.pull-right-30[

```python



# suv 차종 추출
# manufacturer별 분리
# cty 평균 구하기
# 내림차순 정렬
# 상위 5행 추출
```
]

---


Q. 어떤 회사에서 생산한 `'suv'` 차종의 도시 연비가 높은지 알아보려고 합니다. `'suv'` 차종을 대상으로 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `cty`(도시 연비) 평균이 가장 높은 회사 다섯 곳을 막대 그래프로 표현해 보세요. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; •막대는 연비가 높은 순으로 정렬하세요.

- 평균표 만들기


```python
df
```

```
  manufacturer   mean_cty
8       subaru  18.833333
9       toyota  14.375000
7       nissan  13.750000
3         jeep  13.500000
6      mercury  13.250000
```

---

Q. 어떤 회사에서 생산한 `'suv'` 차종의 도시 연비가 높은지 알아보려고 합니다. `'suv'` 차종을 대상으로 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; `cty`(도시 연비) 평균이 가장 높은 회사 다섯 곳을 막대 그래프로 표현해 보세요. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; •막대는 연비가 높은 순으로 정렬하세요.

- 막대 그래프 만들기


```python
sns.barplot(data = df, x = 'manufacturer', y = 'mean_cty')
```


&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-318-41.png" width="58%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-318-42.png" width="58%" /&gt;

---

name: line
class: title1

선 그래프

---

#### 선 그래프(Line Chart)

- 데이터를 선으로 표현한 그래프
- 시계열 그래프(Time Series Chart) : 일정 시간 간격을 두고 나열된 시계열 데이터(Time Series Data)를 선으로 표현한 그래프
- 환율, 주가지수 등 경제 지표가 시간에 따라 어떻게 변하는지 표현할 때 활용

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-319-45.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-319-46.png" width="50%" /&gt;

---

#### 준비하기


```python
economics = pd.read_csv('economics.csv')
economics
```

```
           date      pce         pop  psavert  uempmed  unemploy
0    1967-07-01    506.7  198712.000     12.6      4.5      2944
1    1967-08-01    509.8  198911.000     12.6      4.7      2945
2    1967-09-01    515.6  199113.000     11.9      4.6      2958
3    1967-10-01    512.2  199311.000     12.9      4.9      3143
4    1967-11-01    517.4  199498.000     12.8      4.7      3066
..          ...      ...         ...      ...      ...       ...
569  2014-12-01  12062.0  319746.157      7.6     12.9      8717
570  2015-01-01  12046.0  319928.646      7.7     13.2      8903
571  2015-02-01  12082.4  320074.511      7.9     12.9      8610
572  2015-03-01  12158.3  320230.786      7.4     12.0      8504
573  2015-04-01  12193.8  320402.295      7.6     11.5      8526

[574 rows x 6 columns]
```

---

#### 선 그래프 만들기


```python
sns.lineplot(data = economics, x = 'date', y = 'unemploy')
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-322-49.png" width="60%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-322-50.png" width="60%" /&gt;

---

#### (1) 날짜 시간 타입 변수 만들기


```python
economics.info()
```

```
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 574 entries, 0 to 573
Data columns (total 6 columns):
 #   Column    Non-Null Count  Dtype  
---  ------    --------------  -----  
 0   date      574 non-null    object 
 1   pce       574 non-null    float64
 2   pop       574 non-null    float64
 3   psavert   574 non-null    float64
 4   uempmed   574 non-null    float64
 5   unemploy  574 non-null    int64  
dtypes: float64(4), int64(1), object(1)
memory usage: 27.0+ KB
```
---


```python
# 날짜 시간 타입 변수 만들기
economics['date2'] = pd.to_datetime(economics['date'])

# 변수 타입 확인
economics.info()
```

```
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 574 entries, 0 to 573
Data columns (total 7 columns):
 #   Column    Non-Null Count  Dtype         
---  ------    --------------  -----         
 0   date      574 non-null    object        
 1   pce       574 non-null    float64       
 2   pop       574 non-null    float64       
 3   psavert   574 non-null    float64       
 4   uempmed   574 non-null    float64       
 5   unemploy  574 non-null    int64         
 6   date2     574 non-null    datetime64[ns]
dtypes: datetime64[ns](1), float64(4), int64(1), object(1)
memory usage: 31.5+ KB
```

---


```python
economics[['date', 'date2']]
```

```
           date      date2
0    1967-07-01 1967-07-01
1    1967-08-01 1967-08-01
2    1967-09-01 1967-09-01
3    1967-10-01 1967-10-01
4    1967-11-01 1967-11-01
..          ...        ...
569  2014-12-01 2014-12-01
570  2015-01-01 2015-01-01
571  2015-02-01 2015-02-01
572  2015-03-01 2015-03-01
573  2015-04-01 2015-04-01

[574 rows x 2 columns]
```

---

#### 연, 월, 일 추출



```python
# 연 추출
economics['date2'].dt.year
```

```
0      1967
1      1967
2      1967
3      1967
4      1967
       ... 
569    2014
570    2015
571    2015
572    2015
573    2015
Name: date2, Length: 574, dtype: int32
```

---

#### 연, 월, 일 추출



```python
# 월 추출
economics['date2'].dt.month
```

```
0       7
1       8
2       9
3      10
4      11
       ..
569    12
570     1
571     2
572     3
573     4
Name: date2, Length: 574, dtype: int32
```

---

#### 연, 월, 일 추출


```python
# 일 추출
economics['date2'].dt.day
```

```
0      1
1      1
2      1
3      1
4      1
      ..
569    1
570    1
571    1
572    1
573    1
Name: date2, Length: 574, dtype: int32
```

---

#### 연, 월, 일 추출


```python
# object 타입 X
economics['date'].dt.year
```

    ...AttributeError: Can only use .dt accessor with datetimelike values


---

#### (2) 연도 변수 만들기


```python
# 연도 변수 추가
economics['year'] = economics['date2'].dt.year
economics.head()
```

```
         date    pce       pop  psavert  uempmed  unemploy      date2  year
0  1967-07-01  506.7  198712.0     12.6      4.5      2944 1967-07-01  1967
1  1967-08-01  509.8  198911.0     12.6      4.7      2945 1967-08-01  1967
2  1967-09-01  515.6  199113.0     11.9      4.6      2958 1967-09-01  1967
3  1967-10-01  512.2  199311.0     12.9      4.9      3143 1967-10-01  1967
4  1967-11-01  517.4  199498.0     12.8      4.7      3066 1967-11-01  1967
```

---

#### (3) x축에 연도 표시하기


```python
sns.lineplot(data = economics, x = 'year', y = 'unemploy')
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-332-53.png" width="60%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-332-54.png" width="60%" /&gt;


---

#### 신뢰 구간(confidence interval) 제거


```python
sns.lineplot(data = economics, x = 'year', y = 'unemploy', errorbar = None)
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-334-57.png" width="60%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-334-58.png" width="60%" /&gt;


---


### 혼자서 해보기

`economics` 데이터를 이용해서 분석 문제를 해결해 보세요.

Q1. `psavert`(개인 저축률)가 연도별로 어떻게 변해왔는지 알아보려고 합니다. 연도별 개인 저축률의 &lt;br&gt; &amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp;변화를 나타낸 시계열 그래프를 만들어 보세요(신뢰 구간은 제거하세요).

Q2. 2014년 월별 `psavert`의 변화를 나타낸 시계열 그래프를 만들어 보세요.

---

Q1. `psavert`(개인 저축률)가 연도별로 어떻게 변해왔는지 알아보려고 합니다. 연도별 개인 저축률의 &lt;br&gt; &amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp;변화를 나타낸 시계열 그래프를 만들어 보세요(신뢰 구간은 제거하세요).



```python
sns.lineplot(data = economics, x = 'year', y = 'psavert', errorbar = None)
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-336-61.png" width="60%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-336-62.png" width="60%" /&gt;

---
Q2. 2014년 월별 `psavert`의 변화를 나타낸 시계열 그래프를 만들어 보세요.

&lt;br-back-20&gt;


```python
# month 변수 추가
economics['month'] = economics['date2'].dt.month                     

# 2014년 추출
df_2014 = economics.query('year == 2014')                            

# 선 그래프 만들기
sns.lineplot(data = df_2014, x = 'month', y = 'psavert', errorbar = None)  
```

&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-338-65.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-338-66.png" width="50%" /&gt;




---

Q2. 2014년 월별 `psavert`의 변화를 나타낸 시계열 그래프를 만들어 보세요.

- 월 모두 표시하기


```python
sns.lineplot(data = df_2014, x = 'month', y = 'psavert', errorbar = None) \
   .set_xticks(ticks = range(1, 13))
```


&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-341-69.png" width="60%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-341-70.png" width="60%" /&gt;


---


name: boxplot
class: title1

상자 그림

---

#### 상자 그림

- 상자 그림(Box Plot) : 데이터의 분포(퍼져 있는 형태)를 직사각형 상자 모양으로 표현한 그래프
- 분포를 알 수 있기 때문에 평균만 볼 때보다 데이터의 특징을 좀 더 자세히 이해할 수 있음


&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-342-73.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-342-74.png" width="50%" /&gt;


---

#### 상자 그림 만들기

```python
sns.boxplot(data = mpg, x = 'drv', y = 'hwy')
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-344-77.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-344-78.png" width="50%" /&gt;

---

#### 상자 그림 기준값


```python
mpg.groupby('drv').describe()['hwy'].round(1)
```

```
     count  mean  std   min   25%   50%   75%   max
drv                                                
4    103.0  19.2  4.1  12.0  17.0  18.0  22.0  28.0
f    106.0  28.2  4.2  17.0  26.0  28.0  29.0  44.0
r     25.0  21.0  3.7  15.0  17.0  21.0  24.0  26.0
```

---

#### 상자 그림 정렬하기


```python
sns.boxplot(data = mpg, x = 'drv', y = 'hwy', order = ['f', 'r', '4'])
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-347-81.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-347-82.png" width="50%" /&gt;


---

#### 상자 그림 정렬하기 - 방법2


```python
# (1) 순서 구하기
drv_order = mpg.groupby('drv')['hwy'].median().sort_values(ascending = False)
drv_order
```

```
drv
f    28.0
r    21.0
4    18.0
Name: hwy, dtype: float64
```

```python
drv_order.index
```

```
Index(['f', 'r', '4'], dtype='object', name='drv')
```

---

#### 상자 그림 정렬하기 - 방법2


```python
# (2) 박스플롯에 적용하기
sns.boxplot(data = mpg, x = 'drv', y = 'hwy', order = drv_order.index)
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-350-85.png" width="50%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-350-86.png" width="50%" /&gt;

---


### 혼자서 해보기

**`mpg` 데이터를 이용해서 분석 문제를 해결해 보세요.**

Q1. `category`(자동차 종류)가 `'compact'`, `'subcompact'`, `'suv'`인 자동차의 `cty`(도시 연비)가 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 어떻게 다른지 비교해보려고 합니다. 세 차종의 `cty`를 나타낸 상자 그림을 만들어보세요.

Q2. 상자 그림을 중앙값이 큰 순으로 정렬하세요.

---

Q1. `category`(자동차 종류)가 `'compact'`, `'subcompact'`, `'suv'`인 자동차의 `cty`(도시 연비)가 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 어떻게 다른지 비교해보려고 합니다. 세 차종의 `cty`를 나타낸 상자 그림을 만들어보세요.


```python
# mpg 데이터 불러오기
mpg = pd.read_csv('mpg.csv')

# compact, subcompact, suv 차종 추출
df = mpg.query('category in ["compact", "subcompact", "suv"]')

# 박스플롯 만들기
sns.boxplot(data = df, x = 'category', y = 'cty')
```


&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-352-89.png" width="40%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-352-90.png" width="40%" /&gt;

---

Q2. 상자 그림을 중앙값이 큰 순으로 정렬하세요.


```python
sns.boxplot(data = df, 
            x = 'category', 
            y = 'cty', 
            order = ['compact', 'subcompact', 'suv'])
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-354-93.png" width="40%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-354-94.png" width="40%" /&gt;

---

Q2. 상자 그림을 중앙값이 큰 순으로 정렬하세요.

- 방법2


```python
# 순서 구하기
order = df.groupby('category')['cty'].median().sort_values(ascending = False)

# 박스플롯에 적용하기
sns.boxplot(data = df, 
            x = 'category', 
            y = 'cty', 
            order = order.index)
```


&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-356-97.png" width="40%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-356-98.png" width="40%" /&gt;




---



class: title0

쉽게 배우는 Python 데이터 분석 Part 4

---

name: join
class: title0

&lt;6&gt; 데이터 합치기

---

#### 가로로 합치기 - 열 추가

&lt;img src="img/left_join.png" width="600px" style="display: block; margin: auto auto auto 0;" /&gt;

&lt;br&gt;

#### 세로로 합치기 - 행 추가

&lt;img src="img/bind_rows.png" width="600px" style="display: block; margin: auto auto auto 0;" /&gt;

---

name: left_join
class: title1

가로로 합치기


---

### 가로로 합치기

#### 데이터 생성

```python
# 중간고사 데이터 생성
test1 = pd.DataFrame({'id'      : [1, 2, 3, 4, 5],
                      'midterm' : [60, 80, 70, 90, 85]})
```



```python
# 기말고사 데이터 생성
test2 = pd.DataFrame({'id'    : [1, 2, 3, 4, 5],
                      'final' : [70, 83, 65, 95, 80]})
```

---


```python
test1  # test1 출력
```

```
   id  midterm
0   1       60
1   2       80
2   3       70
3   4       90
4   5       85
```

```python
test2  # test2 출력
```

```
   id  final
0   1     70
1   2     83
2   3     65
3   4     95
4   5     80
```

---

#### id 기준으로 합치기


```python
total = pd.merge(test1, test2, how = 'left', on = 'id')  # id 기준으로 합치기
total
```

```
   id  midterm  final
0   1       60     70
1   2       80     83
2   3       70     65
3   4       90     95
4   5       85     80
```

---

### 연습!

.scroll-box-24[

```python
exam = pd.read_csv('exam.csv')
exam
```

```
    id  nclass  math  english  science
0    1       1    50       98       50
1    2       1    60       97       60
2    3       1    45       86       78
3    4       1    30       98       58
4    5       2    25       80       65
5    6       2    50       89       98
6    7       2    80       90       45
7    8       2    90       78       25
8    9       3    20       98       15
9   10       3    50       98       45
10  11       3    65       65       65
11  12       3    45       85       32
12  13       4    46       98       65
13  14       4    48       87       12
14  15       4    75       56       78
15  16       4    58       98       65
16  17       5    65       68       98
17  18       5    80       78       90
18  19       5    89       68       87
19  20       5    78       83       58
```
]
---
#### 반별 담임교사 명단 생성


```python
name = pd.DataFrame({'nclass'  : [1, 2, 3, 4, 5],
                     'teacher' : ['kim', 'lee', 'park', 'choi', 'jung']})
name
```

```
   nclass teacher
0       1     kim
1       2     lee
2       3    park
3       4    choi
4       5    jung
```
---

#### nclass 기준 합치기
.scroll-box-24[

```python
exam_new = pd.merge(exam, name, how = 'left', on = 'nclass')
exam_new
```

```
    id  nclass  math  english  science teacher
0    1       1    50       98       50     kim
1    2       1    60       97       60     kim
2    3       1    45       86       78     kim
3    4       1    30       98       58     kim
4    5       2    25       80       65     lee
5    6       2    50       89       98     lee
6    7       2    80       90       45     lee
7    8       2    90       78       25     lee
8    9       3    20       98       15    park
9   10       3    50       98       45    park
10  11       3    65       65       65    park
11  12       3    45       85       32    park
12  13       4    46       98       65    choi
13  14       4    48       87       12    choi
14  15       4    75       56       78    choi
15  16       4    58       98       65    choi
16  17       5    65       68       98    jung
17  18       5    80       78       90    jung
18  19       5    89       68       87    jung
19  20       5    78       83       58    jung
```
]
---


name: bind
class: title1

세로로 합치기

---

### 세로로 합치기

#### 데이터 생성

```python
# 학생 1~5번 시험 데이터 생성
group_a = pd.DataFrame({'id'   : [1, 2, 3, 4, 5],
                        'test' : [60, 80, 70, 90, 85]})
                        
# 학생 6~10번 시험 데이터 생성
group_b = pd.DataFrame({'id'   : [6, 7, 8, 9, 10],
                        'test' : [70, 83, 65, 95, 80]})
```

---


```python
group_a  # group_a 출력
```

```
   id  test
0   1    60
1   2    80
2   3    70
3   4    90
4   5    85
```

```python
group_b  # group_b 출력
```

```
   id  test
0   6    70
1   7    83
2   8    65
3   9    95
4  10    80
```

---


```python
# 데이터 합쳐서 group_all에 할당
group_all = pd.concat([group_a, group_b])  
group_all
```

```
   id  test
0   1    60
1   2    80
2   3    70
3   4    90
4   5    85
0   6    70
1   7    83
2   8    65
3   9    95
4  10    80
```

---


```python
# index 새로 설정
group_all = pd.concat([group_a, group_b], ignore_index = True)  
group_all
```

```
   id  test
0   1    60
1   2    80
2   3    70
3   4    90
4   5    85
5   6    70
6   7    83
7   8    65
8   9    95
9  10    80
```

---

### 혼자서 해보기

`mpg` 데이터를 이용해서 분석 문제를 해결해 보세요.

`mpg` 데이터의 `fl` 변수는 자동차에 사용하는 연료(fuel)를 의미합니다. 아래는 자동차 연료별 가격을 나타낸 표입니다.


.left[

fl  |연료 종류  |가격(갤런당 USD)
:--:|:---------:|:---:
&amp;nbsp; &amp;nbsp; &amp;nbsp; c &amp;nbsp; &amp;nbsp; &amp;nbsp; |CNG        |2.35
&amp;nbsp; &amp;nbsp; &amp;nbsp; d &amp;nbsp; &amp;nbsp; &amp;nbsp; |diesel     |2.38
&amp;nbsp; &amp;nbsp; &amp;nbsp; e &amp;nbsp; &amp;nbsp; &amp;nbsp; |ethanol E85|2.11
&amp;nbsp; &amp;nbsp; &amp;nbsp; p &amp;nbsp; &amp;nbsp; &amp;nbsp; |premium    |2.76
&amp;nbsp; &amp;nbsp; &amp;nbsp; r &amp;nbsp; &amp;nbsp; &amp;nbsp; |regular    |2.22

]

---

### 혼자서 해보기

이 정보를 이용해 연료와 가격으로 구성된 데이터 프레임을 만들어 보세요.


```python
fuel = pd.DataFrame({'fl'       : ['c', 'd', 'e', 'p', 'r'],
                     'price_fl' : [2.35, 2.38, 2.11, 2.76, 2.22]})
fuel
```

```
  fl  price_fl
0  c      2.35
1  d      2.38
2  e      2.11
3  p      2.76
4  r      2.22
```

Q1. `mpg` 데이터에는 연료 종류를 나타낸 `fl` 변수는 있지만 연료 가격을 나타낸 변수는 없습니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 위에서 만든 `fuel` 데이터를 이용해서 `mpg` 데이터에 `price_fl`(연료 가격) 변수를 추가하세요.

Q2. 연료 가격 변수가 잘 추가됐는지 확인하기 위해서 `model`, `fl`, `price_fl` 변수를 추출해 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 앞부분 5행을 출력해 보세요.

---

Q1. `mpg` 데이터에는 연료 종류를 나타낸 `fl` 변수는 있지만 연료 가격을 나타낸 변수는 없습니다. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 위에서 만든 `fuel` 데이터를 이용해서 `mpg` 데이터에 `price_fl`(연료 가격) 변수를 추가하세요.

```python
mpg = pd.read_csv('mpg.csv')                        # mpg 데이터 불러오기
mpg = pd.merge(mpg, fuel, how = 'left', on = 'fl')  # mpg에 연료 가격 변수 추가
```

--

&lt;br&gt;

Q2. 연료 가격 변수가 잘 추가됐는지 확인하기 위해서 `model`, `fl`, `price_fl` 변수를 추출해 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 앞부분 5행을 출력해 보세요.


```python
mpg[['model', 'fl', 'price_fl']].head()
```

```
  model fl  price_fl
0    a4  p      2.76
1    a4  p      2.76
2    a4  p      2.76
3    a4  p      2.76
4    a4  p      2.76
```




---



name: cleansing
class: title0

&lt;7&gt; 데이터 정제하기

---

.center[
### 데이터 정제하기
### - 빠진 데이터, 이상한 데이터 제거하기
]

&lt;br&gt;
&lt;img src="img/cleansing.png" width="600px" style="display: block; margin: auto;" /&gt;

---

name: missing_value
class: title1

빠진 데이터를 찾아라! &lt;br&gt;- 결측치 정제하기
---

#### 결측치(Missing Value)
- 누락된 값, 비어있는 값
- 함수 적용 불가, 분석 결과 왜곡
- 제거 후 분석

---


#### 결측치 만들기


- `NaN`


```python
import numpy as np
np.nan
```

```
nan
```

--


```python
df = pd.DataFrame({'sex'   : ['M', 'F', np.nan, 'M', 'F'],
                   'score' : [5, 4, 3, 4, np.nan]})
                   
df
```

```
   sex  score
0    M    5.0
1    F    4.0
2  NaN    3.0
3    M    4.0
4    F    NaN
```

---


#### 결측치 확인하기

```python
pd.isna(df)        # 결측치 확인
```

```
     sex  score
0  False  False
1  False  False
2   True  False
3  False  False
4  False   True
```

```python
pd.isna(df).sum()  # 결측치 빈도 확인
```

```
sex      1
score    1
dtype: int64
```

---

#### 결측치 있을 때 연산

.pull-left[

```python
df['score']
```

```
0    5.0
1    4.0
2    3.0
3    4.0
*4    NaN
Name: score, dtype: float64
```
]

.pull-right[


```python
df['score'] + 1
```

```
0    6.0
1    5.0
2    4.0
3    5.0
*4    NaN
Name: score, dtype: float64
```
]

---

### 결측치 제거하기

#### 결측치 있는 행 제거하기

```python
df.dropna(subset = 'score')
```

```
   sex  score
0    M    5.0
1    F    4.0
2  NaN    3.0
3    M    4.0
```
---

#### 결측치 제외한 데이터로 분석하기

```python
df_nomiss = df.dropna(subset = 'score')  # 결측치 제외된 데이터 생성
```


--


```python
df_nomiss['score'].mean()                # score 평균
```

```
4.0
```

```python
df_nomiss['score'].sum()                 # score 합계
```

```
16.0
```
---

#### 여러 변수 결측치 동시에 제거하기

```python
# score, sex 결측치 제외
df_nomiss = df.dropna(subset = ['score', 'sex'])
df_nomiss
```

```
  sex  score
0   M    5.0
1   F    4.0
3   M    4.0
```

---

#### 결측치가 하나라도 있으면 제거하기

```python
df_nomiss2 = df.dropna()  # 모든 변수에 결측치 없는 데이터 추출
df_nomiss2
```

```
  sex  score
0   M    5.0
1   F    4.0
3   M    4.0
```

&gt; [유의] 분석에 필요한 데이터까지 손실 될 가능성
 - ex) 성별-소득 관계 분석하는데 지역 결측치까지 제거

---

#### 결측치 포함된 상태로 분석

.pull-left[

```python
df['score'].mean()  # 평균 산출
```

```
4.0
```
]

.pull-right[

```python
df['score'].sum() # 합계 산출
```

```
16.0
```
]


&lt;br&gt;


```python
df.groupby('sex').agg(y = ('score', 'mean'))
```

```
       y
sex     
F    4.0
M    4.5
```


---

### 결측치 대체하기
- 결측치 많을 경우 모두 제외하면 데이터 손실 큼
- 대안: 다른 값 채워넣기

&lt;br&gt;

#### 결측치 대체법(Imputation)
- 대표값(평균, 최빈값 등)으로 일괄 대체
- 통계분석 기법 적용, 추정값으로 대체

---


```python
exam = pd.read_csv('exam.csv')           # 데이터 불러오기
exam.loc[[2, 7, 14], ['math']] = np.nan  # 2, 7, 14행의 math에 NaN 할당
exam
```

```
    id  nclass  math  english  science
0    1       1  50.0       98       50
1    2       1  60.0       97       60
*2    3       1   NaN       86       78
3    4       1  30.0       98       58
4    5       2  25.0       80       65
5    6       2  50.0       89       98
6    7       2  80.0       90       45
*7    8       2   NaN       78       25
8    9       3  20.0       98       15
9   10       3  50.0       98       45
10  11       3  65.0       65       65
11  12       3  45.0       85       32
12  13       4  46.0       98       65
13  14       4  48.0       87       12
*14  15       4   NaN       56       78
15  16       4  58.0       98       65
16  17       5  65.0       68       98
17  18       5  80.0       78       90
18  19       5  89.0       68       87
19  20       5  78.0       83       58
```

---

#### 결측치 대체하기

&lt;br-back-20&gt;

.pull-left[


```python
exam['math']
```

```
0     50.0
1     60.0
*2      NaN
3     30.0
4     25.0
5     50.0
6     80.0
*7      NaN
8     20.0
9     50.0
10    65.0
11    45.0
12    46.0
13    48.0
*14     NaN
15    58.0
16    65.0
17    80.0
18    89.0
19    78.0
Name: math, dtype: float64
```
]

--

.pull-right[


```python
exam['math'].fillna(9999)
```

```
0       50.0
1       60.0
*2     9999.0
3       30.0
4       25.0
5       50.0
6       80.0
*7     9999.0
8       20.0
9       50.0
10      65.0
11      45.0
12      46.0
13      48.0
*14    9999.0
15      58.0
16      65.0
17      80.0
18      89.0
19      78.0
Name: math, dtype: float64
```
]


---

#### 평균으로 대체하기



```python
exam['math'].mean()
```

```
55.23529411764706
```

---

#### 평균으로 대체하기



```python
exam['math'].fillna(exam['math'].mean())
```

```
0     50.000000
1     60.000000
*2     55.235294
3     30.000000
4     25.000000
5     50.000000
6     80.000000
*7     55.235294
8     20.000000
9     50.000000
10    65.000000
11    45.000000
12    46.000000
13    48.000000
*14    55.235294
15    58.000000
16    65.000000
17    80.000000
18    89.000000
19    78.000000
Name: math, dtype: float64
```

---

#### 할당하기


```python
exam['math'] = exam['math'].fillna(exam['math'].mean())
exam
```

```
    id  nclass       math  english  science
0    1       1  50.000000       98       50
1    2       1  60.000000       97       60
*2    3       1  55.235294       86       78
3    4       1  30.000000       98       58
4    5       2  25.000000       80       65
5    6       2  50.000000       89       98
6    7       2  80.000000       90       45
*7    8       2  55.235294       78       25
8    9       3  20.000000       98       15
9   10       3  50.000000       98       45
10  11       3  65.000000       65       65
11  12       3  45.000000       85       32
12  13       4  46.000000       98       65
13  14       4  48.000000       87       12
*14  15       4  55.235294       56       78
15  16       4  58.000000       98       65
16  17       5  65.000000       68       98
17  18       5  80.000000       78       90
18  19       5  89.000000       68       87
19  20       5  78.000000       83       58
```

---



```python
# 결측치 빈도 확인
exam.isna().sum()  
```

```
id         0
nclass     0
math       0
english    0
science    0
dtype: int64
```


---

### 혼자서 해보기

`mpg` 데이터를 이용해서 분석 문제를 해결해 보세요.

`mpg` 데이터에는 결측치가 없습니다. 우선 `mpg` 데이터를 불러와서 일부러 몇 개의 값을 결측치로 만들겠습니다. 아래 코드를 실행하면 다섯 행의 `hwy` 변수에 `NaN`이 할당됩니다.

```python
mpg = pd.read_csv('mpg.csv')                       # mpg 데이터 불러오기
mpg.loc[[65, 124, 131, 153, 212], 'hwy'] = np.nan  # NaN 할당하기
```

---

결측치가 들어 있는 `mpg` 데이터를 활용해 문제를 해결해 보세요.

Q1. `drv`(구동방식)별로 `hwy`(고속도로 연비) 평균이 어떻게 다른지 알아보려고 합니다. 분석을 하기 전에 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 우선 두 변수에 결측치가 있는지 확인하려고 합니다. `drv` 변수와 `hwy` 변수에 결측치가 몇 개 있는지 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 알아보세요.


Q2. `df.dropna()`를 이용해 `hwy` 변수의 결측치를 제거하고, 어떤 구동 방식의 `hwy` 평균이 높은지&lt;br&gt;  &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 알아보세요. 하나의 `pandas` 구문으로 만들어야 합니다.

---

Q1. `drv`(구동방식)별로 `hwy`(고속도로 연비) 평균이 어떻게 다른지 알아보려고 합니다. 분석을 하기 전에 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 우선 두 변수에 결측치가 있는지 확인하려고 합니다. `drv` 변수와 `hwy` 변수에 결측치가 몇 개 있는지 &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 알아보세요.

```python
# 결측치 빈도 확인
mpg[['drv', 'hwy']].isna().sum()  
```

```
drv    0
hwy    5
dtype: int64
```

---

Q2. `df.dropna()`를 이용해 `hwy` 변수의 결측치를 제거하고, 어떤 구동 방식의 `hwy` 평균이 높은지&lt;br&gt;  &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 알아보세요. 하나의 `pandas` 구문으로 만들어야 합니다.

.pull-left[

```python
mpg.dropna(subset = 'hwy') \
   .groupby('drv') \
   .agg(mean_hwy = ('hwy', 'mean'))
```

```
      mean_hwy
drv           
4    19.262626
f    28.009524
r    21.000000
```
]

.pull-right[

```python
# hwy 결측치 제거
# drv별 분리
# hwy 평균 구하기
```
]

---

name: outlier
class: title1

이상한 데이터를 찾아라! &lt;br&gt;- 이상치 정제하기
---

#### 이상치(Outlier) - 정상범주에서 크게 벗어난 값
- 이상치 포함시 분석 결과 왜곡
- 결측 처리 후 제외하고 분석

.left[
이상치 종류      |예                |해결 방법
-----------------|------------------|---------
존재할 수 없는 값&amp;nbsp; |성별 변수에 3     &amp;nbsp; |결측 처리&amp;nbsp;
극단적인 값      &amp;nbsp; |몸무게 변수에 200 &amp;nbsp; |정상범위 기준 정해서 결측 처리&amp;nbsp;
]
---

### 이상치 제거하기 - 1. 존재할 수 없는 값
- 논리적으로 존재할 수 없으므로 바로 결측 처리 후 분석시 제외

#### 이상치 포함된 데이터 생성 - sex 3, score 6

```python
outlier = pd.DataFrame({'sex'   : [1, 2, 1, 3, 2, 1], 
                        'score' : [5, 4, 3, 4, 2, 6]})
outlier
```

```
   sex  score
0    1      5
1    2      4
2    1      3
3    3      4
4    2      2
5    1      6
```

---

#### 이상치 확인하기

```python
outlier['sex'].value_counts().sort_index()
```

```
sex
1    3
2    2
3    1
Name: count, dtype: int64
```

```python
outlier['score'].value_counts().sort_index()
```

```
score
2    1
3    1
4    2
5    1
6    1
Name: count, dtype: int64
```

- `sort_index()`: 변수의 값 순서로 출력

---

#### 결측 처리하기 - sex



```python
# sex가 3이면 NaN 할당
outlier['sex'] = np.where(outlier['sex'] == 3, np.nan, outlier['sex'])
outlier
```

```
   sex  score
0  1.0      5
1  2.0      4
2  1.0      3
3  NaN      4
4  2.0      2
5  1.0      6
```

---

#### 결측 처리하기 - score

```python
# score가 5보다 크면 NaN 할당
outlier['score'] = np.where(outlier['score'] &gt; 5, np.nan, outlier['score'])
outlier
```

```
   sex  score
0  1.0    5.0
1  2.0    4.0
2  1.0    3.0
3  NaN    4.0
4  2.0    2.0
5  1.0    NaN
```

---

#### 결측치 제외하고 분석

.pull-left-60[

```python
outlier.dropna(subset = ['sex', 'score']) \
       .groupby('sex') \
       .agg(mean_score = ('score', 'mean'))
```

```
     mean_score
sex            
1.0         4.0
2.0         3.0
```
]

.pull-right-40[

```python
# sex, score 결측치 제거
# sex별 분리
# score 평균 구하기
```
]


---

### 이상치 제거하기 - 2. 극단적인 값

정상범위 기준 정해서 벗어나면 결측 처리

.left[
&amp;nbsp; 판단 기준   |&amp;nbsp; 예
------------|---
&amp;nbsp; 논리적 판단 &amp;nbsp; |&amp;nbsp; 성인 몸무게 40kg~150kg 벗어나면 극단치&amp;nbsp;
&amp;nbsp; 통계적 판단 &amp;nbsp; |&amp;nbsp; 상하위 0.3% 극단치 또는 상자그림 1.5 IQR 벗어나면 극단치&amp;nbsp;
]
---


### 상자그림으로 극단치 기준 정해서 제거하기

#### 상자그림 만들기





```python
mpg = pd.read_csv('mpg.csv')
sns.boxplot(data = mpg, y = 'hwy')
```

&lt;br-back-10&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-408-1.png" width="40%" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-408-2.png" width="40%" /&gt;

---

#### 극단치 기준값 구하기

**(1) 1사분위수, 3사분위수 구하기**


```python
pct25 = mpg['hwy'].quantile(.25)
pct25
```

```
18.0
```


```python
pct75 = mpg['hwy'].quantile(.75)
pct75
```

```
27.0
```

**(2) IQR 구하기**


```python
iqr = pct75 - pct25
iqr
```

```
9.0
```

---

#### 극단치 기준값 구하기


**(3) 하한, 상한 구하기**


```python
pct25 - 1.5 * iqr  # 하한
```

```
4.5
```


```python
pct75 + 1.5 * iqr  # 상한
```

```
40.5
```

---

#### 극단치를 결측 처리하기


```python
# 4.5 ~ 40.5 벗어나면 NaN 부여
mpg['hwy'] = np.where((mpg['hwy'] &lt; 4.5) | (mpg['hwy'] &gt; 40.5),
                      np.nan, mpg['hwy'])

# 결측치 빈도 확인
mpg['hwy'].isna().sum()
```

```
3
```

--

#### 결측치 제외하고 분석하기

&lt;br-back-10&gt;

.pull-left[

```python
mpg.dropna(subset = 'hwy') \
   .groupby('drv') \
   .agg(mean_hwy = ('hwy', 'mean'))
```

```
      mean_hwy
drv           
4    19.174757
f    27.728155
r    21.000000
```
]

.pull-right[

```python
# hwy 결측치 제거
# drv별 분리
# hwy 평균 구하기
```
]

---

### 혼자서 해보기

`mpg` 데이터를 이용해서 분석 문제를 해결해 보세요.

- 우선 `mpg` 데이터를 불러와서 일부러 이상치를 만들겠습니다.

  - `drv`(구동방식) 변수의 값은 `4`(사륜구동), `f`(전륜구동), `r`(후륜구동) 세 종류로 되어있습니다. &lt;br&gt; &amp;nbsp;몇 개의 행에 존재할 수 없는 값 `k`를 할당하겠습니다.

  - `cty`(도시 연비) 변수도 몇 개의 행에 극단적으로 크거나 작은 값을 할당하겠습니다.


```python
mpg = pd.read_csv('mpg.csv')                         # mpg 데이터 불러오기
mpg.loc[[9, 13, 57, 92], 'drv'] = 'k'                # drv 이상치 할당
mpg.loc[[28, 42, 128, 202], 'cty'] = [3, 4, 39, 42]  # cty 이상치 할당
```

---

### 혼자서 해보기

이상치가 들어 있는 `mpg` 데이터를 활용해 문제를 해결해보세요.

구동방식별로 도시 연비가 다른지 알아보려고 합니다. 분석을 하려면 우선 두 변수에 이상치가 있는지 &lt;br&gt; 확인해야 합니다.

Q1. `drv`에 이상치가 있는지 확인하세요. 이상치를 결측 처리한 다음 이상치가 사라졌는지 확인하세요. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 결측 처리 할 때는 `df.isin()`을 활용하세요.

Q2. 상자 그림을 이용해 `cty`에 이상치가 있는지 확인하세요. 상자 그림 기준으로 정상 범위를 벗어난 값을&lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;  결측 처리한 다음 다시 상자 그림을 만들어 이상치가 사라졌는지 확인하세요.

Q3. 두 변수의 이상치를 결측 처리했으니 이제 분석할 차례입니다. 이상치를 제거한 다음&lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;  `drv`별로 `cty` 평균이 어떻게 다른지 알아보세요. 하나의 `pandas` 구문으로 만들어야 합니다.

---

Q1. `drv`에 이상치가 있는지 확인하세요. 이상치를 결측 처리한 다음 이상치가 사라졌는지 확인하세요. &lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 결측 처리 할 때는 `df.isin()`을 활용하세요.


```python
# 이상치 확인
mpg['drv'].value_counts().sort_index()
```

```
drv
4    100
f    106
k      4
r     24
Name: count, dtype: int64
```

--


```python
# drv가 4, f, r이면 기존 값 유지, 그 외 NaN 할당
mpg['drv'] = np.where(mpg['drv'].isin(['4', 'f', 'r']), mpg['drv'], np.nan)

# 이상치 확인
mpg['drv'].value_counts().sort_index()
```

```
drv
4    100
f    106
r     24
Name: count, dtype: int64
```

---

Q2. 상자 그림을 이용해 `cty`에 이상치가 있는지 확인하세요. 상자 그림 기준으로 정상 범위를 벗어난 값을&lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;  결측 처리한 다음 다시 상자 그림을 만들어 이상치가 사라졌는지 확인하세요.


```python
# 상자 그림 만들기
sns.boxplot(data = mpg, y = 'cty')
```


&lt;br-back-20&gt;

&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-421-5.png" width="500px" height="400px" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-421-6.png" width="500px" height="400px" /&gt;


---

Q2. 상자 그림을 이용해 `cty`에 이상치가 있는지 확인하세요. 상자 그림 기준으로 정상 범위를 벗어난 값을&lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;  결측 처리한 다음 다시 상자 그림을 만들어 이상치가 사라졌는지 확인하세요.



```python
pct25 = mpg['cty'].quantile(.25)  # 1사분위수
pct75 = mpg['cty'].quantile(.75)  # 3사분위수
iqr = pct75 - pct25               # IQR
```

&lt;br10&gt;


```python
pct25 - 1.5 * iqr                 # 하한
```

```
6.5
```

```python
pct75 + 1.5 * iqr                 # 상한
```

```
26.5
```


```python
# 6.5 ~ 26.5 벗어나면 NaN 부여
mpg['cty'] = np.where((mpg['cty'] &lt; 6.5) | (mpg['cty'] &gt; 26.5), 
                      np.nan, mpg['cty'])
```

---

Q2. 상자 그림을 이용해 `cty`에 이상치가 있는지 확인하세요. 상자 그림 기준으로 정상 범위를 벗어난 값을&lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;  결측 처리한 다음 다시 상자 그림을 만들어 이상치가 사라졌는지 확인하세요.



```python
# 상자 그림 만들기
sns.boxplot(data = mpg, y = 'cty')
```


&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-426-9.png" width="500px" height="400px" /&gt;&lt;img src="rmd_merge_child_files/figure-html/unnamed-chunk-426-10.png" width="500px" height="400px" /&gt;

---

Q3. 두 변수의 이상치를 결측 처리했으니 이제 분석할 차례입니다. 이상치를 제거한 다음&lt;br&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;  `drv`별로 `cty` 평균이 어떻게 다른지 알아보세요. 하나의 `pandas` 구문으로 만들어야 합니다.

.pull-left[

```python
mpg.dropna(subset = ['drv', 'cty']) \
   .groupby('drv') \
   .agg(mean_cty = ('cty', 'mean'))
```

```
      mean_cty
drv           
4    14.247423
f    19.470000
r    13.958333
```
]

.pull-right[

```python
# drv, cty 결측치 제거
# drv별 분리
# cty 평균 구하기
```
]

---


name: option
class: title1

Options

---

#### 데이터 프레임 출력 제한 설정하기

- 60행 넘기면 상하 5행씩 10행만 출력
- 20열 넘기면 좌우 10열씩 20열만 출력


```python
import pandas as pd

# 출력 제한 없애기
pd.set_option('display.max_rows', None)     # 모든 행 출력하도록 설정
pd.set_option('display.max_columns', None)  # 모든 열 출력하도록 설정

# 원래대로 되돌리기
pd.reset_option('display.max_rows')         # 행 출력 제한 되돌리기
pd.reset_option('display.max_columns')      # 열 출력 제한 되돌리기
pd.reset_option('all')                      # 모든 설정 되돌리기
```

---

#### 그래프 설정하기


```python
import matplotlib as plt
plt.rcParams.update({'figure.dpi' : '150'})             # 해상도, 기본값 72
plt.rcParams.update({'figure.figsize' : [8, 6]})        # 그림 크기, 기본값 [6, 4]
plt.rcParams.update({'font.size': '15'})                # 글자 크기, 기본값 10
plt.rcParams.update({'font.family' : 'Malgun Gothic'})  # 폰트, 기본값 sans-serif

# 한 번에 여러 설정 바꾸기
plt.rcParams.update({'figure.dpi' : '150',  
                     'figure.figsize' : [8, 6],
                     'font.size': '15',
                     'font.family' : 'Malgun Gothic'})

# 그래프 설정 기본값 출력
plt.rcParamsDefault

# 설정 되돌리기
plt.rcParams.update(plt.rcParamsDefault)
```

&lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#FF7333;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"&gt;&lt;/path&gt;&lt;/svg&gt; 맥에서는 폰트 `'AppleGothic'`

---

#### 그래프 설정하기

`&lt;AxesSubplot...` 메시지 숨기기: 코드 뒤에 `;` 입력


```python
sns.scatterplot(data = mpg, x = 'displ', y = 'hwy');
```


---


class: title1

&lt;끝&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true,
"ratio": "16:10",
"navigation": {
"scroll": true
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
